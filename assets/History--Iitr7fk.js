import{r as s,A as Y,u as G,h as J,c as O,b as Z,S as _,U as ee,j as e,F as se,K as te,f as C,E as oe,d as ae,V as L,W as re,X as ie,Y as ne}from"./index-bRWVs4uH.js";import{C as E}from"./ConfirmDelete-NqjvmjUg.js";import{L as le}from"./LoadingScreen-s9LTCXQM.js";import{M as H}from"./EmptyComponent-B0v7Kud4.js";import{S as ce}from"./SkeletonHistory-TWQvy6cT.js";import"./Dialog-uv1MMool.js";import"./Modal-AoQCLYuG.js";import"./Portal-VKXgkAI7.js";import"./Stack-oEJLfJtD.js";import"./Skeleton-gudHJ97I.js";const ve=()=>{const{deleteFromHistory:a,setHeaderTitle:n,userId:c,historyCount:x}=s.useContext(Y),d=G(),[r,p]=s.useState([]),[D,g]=s.useState(null),[$,m]=s.useState(!1),[k,l]=s.useState(!1),[A,B]=s.useState(!1),[u,M]=s.useState([]),T=J(),{mode:h}=T.palette,R=O(Z(ae,"users",c),"history"),[y,f]=s.useState(!0),[V,w]=s.useState(!1),[S,z]=s.useState(null),[F,P]=s.useState(!0),[j,q]=s.useState(0),[v,K]=s.useState(null),I=8,N=async()=>{f(!0);let t=L(R,re(I));v&&(t=L(t,ie(v)));try{const o=await ne(t);if(o.empty)w(!0);else{const i=o.docs.map(b=>({id:b.id,...b.data()}));p([...r,...i]),K(o.docs[o.docs.length-1]),C(f),q(j+1),i.length<I&&P(!1)}}catch(o){const i="Error fetching history: "+o.message;console.log(i),f(!1),z(i)}};s.useEffect(()=>{N()},[]);const Q=t=>{A||d(`/app/history/${t.id}`)},U=()=>{a(D),g(null),m(!1)},W=()=>{m(!1),g(null)},X=()=>{const t=r.filter(o=>!u.includes(o.id));p(t),M([]),l(!1),B(!1)};return _("history-page"),ee("history-page"),s.useEffect(()=>{n("History")},[]),y&&j===0?e.jsx(le,{isLoading:y,text:"Loading history..."}):V?e.jsx(H,{text:"No items available"}):S?e.jsx(H,{text:S}):e.jsxs("div",{className:"m-2",children:[e.jsx(E,{data:{value:k,setValue:l,text:`Are you sure to delete ${u.length} ${u.length<=1?"item":"items"} ?`,yesButton:X,noButton:()=>l(!1),setValue:l}}),e.jsx(E,{data:{value:$,text:"Are you sure to delete ?",yesButton:U,noButton:W,setValue:m}}),e.jsxs("div",{className:`grid border  rounded-md shadow-md ${h==="dark"?"border-slate-700":"border-slate-200"}`,children:[r.map((t,o)=>e.jsx(de,{h:t,index:o,goToResults:Q,mode:h},`history-item-${t.id}`)),F?e.jsx("div",{className:"flex justify-center mt-1 mb-2 ",children:e.jsx(se,{size:"small",onClick:N,children:"load more"})}):""]})]})},de=te.memo(({h:a,index:n,goToResults:c,mode:x})=>{const[d,r]=s.useState(!0);return C(r,2e3),d?e.jsx(ce,{}):e.jsxs(oe,{onClick:()=>c(a,n),className:`min-h-20 p-2 border-t  cursor-pointer ${n===0&&"border-t-0"} gap-x-3 ${x==="dark"?"border-slate-700":"border-slate-200"} `,children:[e.jsx("div",{className:"font-medium",children:a.testName}),e.jsx("div",{className:"p-2 flex items-center gap-x-2",children:e.jsx("div",{className:"flex flex-1 items-center gap-x-3",children:e.jsxs("div",{className:"flex-1 sm:flex items-center gap-x-3 ",children:[e.jsxs("div",{className:"",children:["Score: ",a.score," / ",a.results.length," "]}),e.jsxs("div",{className:" ",children:["Date: ",a.date," (",` ${a.time}`,")"]})]})})})]})});export{ve as default};
