import{j as e,r as i,A as I,u as M,d as z,b as B,c as U,aB as J,e as R,a as K,s as E,f as k,aU as W,aV as X}from"./index-14pqm9y1.js";import{C as Z}from"./ConfirmDelete-RLdVewKK.js";import{T as _}from"./Tooltip-cTALVPIn.js";import{I as ee}from"./IconButton-x0ar69Y7.js";import{A as F}from"./ArrowBackSharp-LySXSozB.js";import{g as te}from"./getImage-SzyEh5nT.js";import{n as se}from"./notify-fX9PdEbD.js";import{B as C}from"./Button-dux8T5OH.js";import{c as H}from"./createSvgIcon-BoAk_7pD.js";import{L as re}from"./LoadingScreen-EYXdXKre.js";import{M as D}from"./EmptyComponent-LbBV4xaA.js";import"./Dialog-7UnCDBMC.js";import"./Modal-XJP-E1k3.js";import"./Portal-YB56xSUH.js";import"./Typography-F2i8tb5R.js";import"./Stack-bBqHnaWs.js";import"./useControlled-qBYEK2eV.js";import"./ButtonBase-ryrwXNwG.js";const ne=H(e.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForwardSharp"),oe=H(e.jsx("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"}),"DoneSharp"),ae=({data:n})=>{const{pageTitle:t,currentPage:o,totalPage:s,percentage:r,answerLength:c,questionsLength:a}=n,{stopTest:m,formattedTime:l}=i.useContext(I),d=M(),[p,f]=i.useState(!1),v=()=>{m(),f(!1),d("/app/tests")},h=()=>{f(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:" font-medium text-lg flex items-center justify-start",children:[e.jsx(_,{title:"Navigate up",arrow:!0,children:e.jsx(ee,{onClick:()=>f(!0),children:e.jsx(F,{})})}),e.jsx("div",{className:"ml-2 ",children:t}),e.jsx(Z,{data:{value:p,yesButton:v,noButton:h,text:"Are you sure to stop the test ?",setValue:f}})]}),e.jsxs("div",{className:"flex justify-between items-center sticky left-0 pt-1 right-0 z-10 ",children:[e.jsxs("div",{children:["Page ",o," of ",s]}),e.jsxs("div",{className:"w-2/3 border h-7 relative",children:[e.jsx("div",{style:{width:`${r}%`},className:"text-center h-full"}),e.jsxs("div",{className:"absolute top-0 left-2 font-medium",children:[c," ","/"," ",a]})]}),e.jsx("div",{className:"min-h-12 font-medium fixed right-0 top-1/4 h-10 min-w-20 bg-lime-200/50 backdrop-blur-lg flex items-center justify-center rounded-bl-lg rounded-tl-lg border-r-4 border-r-blue-400",children:l})]})]})},ie=({data:n})=>{const{currentQuestions:t,chooseAnswer:o,answeredQuestions:s}=n;return e.jsx("div",{children:t==null?void 0:t.map((r,c)=>e.jsxs("div",{children:[e.jsxs("div",{className:"grid gap-y-2",children:[e.jsxs("div",{className:"flex gap-x-3 items-center",children:[e.jsx("div",{className:"bg-blue-600 rounded-sm shadow-lg h-9 w-9 text-white font-bold flex justify-center items-center ",children:r.id}),e.jsx("div",{className:"flex-1 font-padauk",children:r.question})]}),e.jsx("div",{className:"grid gap-y-2",children:r.choices.map((a,m)=>{let l,d=!1;return s.forEach(p=>{r.id===p.id&&(l=p)}),(l==null?void 0:l.userAnswer)===a&&(d=!0),e.jsxs("div",{onClick:()=>{o(r.id,a)},className:"border  h-12 flex gap-x-3 p-2 cursor-pointer items-center rounded-lg font-padauk",children:[e.jsx("input",{onChange:()=>{o(r.id,a)},className:"h-5 w-5",name:`question-${r.id}`,type:"radio",checked:!!d}),e.jsx("div",{children:a})]},`choice-${r.id}-${m}-${a}`)})})]}),e.jsx(ce,{})]},`question-${r.id}-${c}-${r.question}`))})},ce=()=>e.jsx("div",{className:" border border-dashed border-gray-500 mb-7 mt-7"}),le=()=>e.jsxs("div",{className:"flex gap-x-2 items-center",children:[e.jsx("img",{className:"w-8 ",src:te("error")}),e.jsx("div",{className:"text-red-600 font-bold",children:"You need to answer all questions before proceeding!"})]});function de(n,t,o){const s=t.name,r=ue(n,t.quizzes),c=me(r),a=n.length,m=t.gradingRules.length!==0?fe(c,t.gradingRules)||"There is an error in your grading rules":"Level is not defined",l=he(),d=xe();return{testName:s,results:r,score:c,totalScore:a,level:m,date:l,time:d,timeTaken:o}}function ue(n,t){return t.map(s=>{const{id:r,question:c,answer:a}=s;let m;n.forEach(d=>{r===d.id&&(m=d)});const{userAnswer:l}=m;return l===s.answer?{id:r,question:c,userAnswer:l,answer:a,isTrue:!0}:{id:r,question:c,userAnswer:l,answer:a,isTrue:!1}})}function me(n){let t=0;return n.forEach(o=>{o.isTrue&&t++}),t}function fe(n,t){let o;try{t.forEach(s=>{n>=Number(s.from)&&n<=Number(s.to)&&(o=s.level)})}catch(s){console.log(s.message)}return o}function he(){const n=new Date,t=n.getDate(),o=n.getMonth()+1,s=n.getFullYear();return`${t}/${o}/${s}`}function xe(){const n=new Date;let t=n.getHours();const o=n.getMinutes(),s=t>12?"PM":"AM";t=t%12||12;const r=o<10?`0${o}`:o;return`${t}:${r} ${s}`}const ge=({data:n})=>{const{nextPage:t,prevPage:o,isEnded:s,startIndex:r,currentTest:c,answeredQuestions:a,testId:m}=n,{formattedTime:l,stopTest:d,userId:p}=i.useContext(I),f=M(),v=async()=>{try{const x=U(B(z,"users",p),"history"),u=de(a,c,l),y=await J(x,u),b=(await R(y)).id;f(`/app/history/${b}`)}catch(x){console.log(x.message)}},h=async()=>{await v(),d(),se(["took","test"],"testName",c.name,null,m)};return e.jsxs("div",{className:"flex justify-center gap-x-5",children:[r!==0&&e.jsx(C,{variant:"outlined",size:"small",onClick:o,startIcon:e.jsx(F,{}),children:"Previous"}),s?e.jsx(C,{variant:"outlined",size:"small",onClick:h,startIcon:e.jsx(oe,{}),children:"Finish"}):e.jsx(C,{variant:"outlined",size:"small",onClick:t,startIcon:e.jsx(ne,{}),children:"Next"})]})},Re=()=>{var L,P;i.useContext(I);const{testId:n}=K(),[t,o]=i.useState([]),[s,r]=i.useState(null),[c,a]=i.useState(!0),[m,l]=i.useState(!1),[d,p]=i.useState(null),[f,v]=i.useState(!1);i.useEffect(()=>{(async()=>{try{a(!0);const j=B(z,"tests",n),N=await R(j);N.exists()?(r(N.data()),k(a,1200)):(k(a),l(!0))}catch(j){k(a,1200),p("Failed to fetch current test: "+j.message)}})()},[]);const h=t==null?void 0:t.length,x=(L=s==null?void 0:s.quizzes)==null?void 0:L.length,[u,y]=i.useState(0),[b,T]=i.useState(!1),[G,A]=i.useState(!1),g=10;let V=(P=s==null?void 0:s.quizzes)==null?void 0:P.slice(u,u+g);const Y=s==null?void 0:s.name,q=Math.ceil(x/g),O=Math.ceil((u+g)/g),Q=Math.round(h/x*100);i.useEffect(()=>(E(),E()),[]),i.useEffect(()=>{h===x&&u+g>=x?T(!0):T(!1)},[u,t]),i.useEffect(()=>{h>=u+g?A(!0):A(!1)},[t,u]);const S={pageTitle:Y,currentPage:O,totalPage:q,percentage:Q,answerLength:h,questionsLength:x,answeredQuestions:t,currentQuestions:V,isEnded:b,chooseAnswer:(w,j)=>{const N=X(w,t);o(N?t.map($=>w===$.id?{id:w,userAnswer:j}:$):[...t,{id:w,userAnswer:j}])},nextPage:()=>{G?(y(u+g),h<=u+g&&E()):W(v)},prevPage:()=>{y(Math.max(u-g,0))},startIndex:u,currentTest:s,testId:n};return c?e.jsx(re,{isLoading:c,text:"Loading test..."}):m?e.jsx(D,{text:"No test available"}):d?e.jsx(D,{text:f}):e.jsxs("div",{className:"p-3 grid gap-y-3",children:[e.jsx(ae,{data:S}),e.jsx(ie,{data:S}),f&&e.jsx(le,{}),e.jsx(ge,{data:S})]})};export{Re as default};
