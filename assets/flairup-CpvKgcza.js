function f(t){return[].concat(t)}function S(t){return t.startsWith(":")}function C(t){return d(t)&&(t==="*"||t.length>1&&":>~.+*".includes(t.slice(0,1))||w(t))}function m(t,s){return(d(s)||typeof s=="number")&&!N(t)&&!S(t)&&!$(t)}function $(t){return t.startsWith("@media")}function V(t){return t==="."}function N(t){return t==="--"}function d(t){return t+""===t}function w(t){return d(t)&&(t.startsWith("&")||S(t))}function a(t,s=""){return t.filter(Boolean).join(s)}function P(t,s){let n=0;if(s.length===0)return n.toString();for(let i=0;i<s.length;i++){const e=s.charCodeAt(i);n=(n<<5)-n+e,n=n&n}return`${t??"cl"}_${n.toString(36)}`}function x(t,s){return t==="content"?`"${s}"`:s}function M(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function g(t,s){return`${t}:${s}`}function W(t){return t?`.${t}`:""}function k(t,s){return t?`${t}
${s}`:s}var T=class R{constructor(s,n,i,e){this.sheet=s,this.property=n,this.value=i,this.selector=e,this.property=n,this.value=i,this.joined=g(n,i);const o=this.selector.preconditions.concat(this.selector.postconditions);this.hash=this.selector.hasConditions?this.selector.scopeClassName:P(this.sheet.name,this.joined),this.key=a([this.joined,o,this.hash])}toString(){let s=p(this.selector.preconditions,{right:this.hash});return s=p(this.selector.postconditions,{left:s}),`${s} {${R.genRule(this.property,this.value)}}`}static genRule(s,n){const i=M(s);return g(i,x(s,n))+";"}};function p(t,{left:s="",right:n=""}={}){const i=t.reduce((e,o)=>S(o)?e+o:w(o)?e+o.slice(1):a([e,o]," "),s);return a([i,W(n)]," ")}var B=class h{constructor(s,n=null,{preconditions:i,postconditions:e}={}){this.sheet=s,this.preconditions=[],this.scopeClassName=null,this.scopeName=null,this.postconditions=[],this.preconditions=i?f(i):[],this.postconditions=e?f(e):[],this.setScope(n)}setScope(s){return s?(this.scopeClassName||(this.scopeName=s,this.scopeClassName=P(this.sheet.name,s+this.sheet.count)),this):this}get hasConditions(){return this.preconditions.length>0||this.postconditions.length>0}addScope(s){return new h(this.sheet,s,{preconditions:this.preconditions,postconditions:this.postconditions})}addPrecondition(s){return new h(this.sheet,this.scopeClassName,{postconditions:this.postconditions,preconditions:this.preconditions.concat(s)})}addPostcondition(s){return new h(this.sheet,this.scopeClassName,{preconditions:this.preconditions,postconditions:this.postconditions.concat(s)})}createRule(s,n){return new T(this.sheet,s,n,this)}},D=class{constructor(t,s){this.name=t,this.rootNode=s,this.storedStyles={},this.storedClasses={},this.style="",this.count=0,this.id=`flairup-${t}`,this.styleTag=this.createStyleTag()}getStyle(){return this.style}append(t){this.style=k(this.style,t)}apply(){this.count++,this.styleTag&&(this.styleTag.innerHTML=this.style)}isApplied(){return!!this.styleTag}createStyleTag(){if(typeof document>"u"||this.isApplied()||this.rootNode===null)return this.styleTag;const t=document.createElement("style");return t.type="text/css",t.id=this.id,(this.rootNode??document.head).appendChild(t),t}addRule(t){const s=this.storedClasses[t.key];return d(s)?s:(this.storedClasses[t.key]=t.hash,this.storedStyles[t.hash]=[t.property,t.value],this.append(t.toString()),t.hash)}};function y(t,s){for(const n in t)s(n.trim(),t[n])}function H(...t){const s=t.reduce((n,i)=>(i instanceof Set?n.push(...i):typeof i=="string"?n.push(i):Array.isArray(i)?n.push(H(...i)):typeof i=="object"&&Object.entries(i).forEach(([e,o])=>{o&&n.push(e)}),n),[]);return a(s," ").trim()}function Q(t,s){const n=new D(t,s);return{create:i,getStyle:n.getStyle.bind(n),isApplied:n.isApplied.bind(n)};function i(e){const o={};return j(n,e,new B(n)).forEach(([c,l,E])=>{u(n,l,E).forEach(b=>{r(c,b)})}),n.apply(),o;function r(c,l){o[c]=o[c]??new Set,o[c].add(l)}}}function j(t,s,n){const i=[];return y(s,(e,o)=>{if(C(e))return j(t,o,n.addPrecondition(e)).forEach(r=>i.push(r));i.push([e,s[e],n.addScope(e)])}),i}function u(t,s,n){const i=new Set;return y(s,(e,o)=>{let r=[];if(C(e))r=u(t,o,n.addPostcondition(e));else if(V(e))r=f(o);else if($(e))r=L(t,o,e,n);else if(N(e))r=I(t,o,n);else if(m(e,o)){const c=n.createRule(e,o);t.addRule(c),i.add(c.hash)}return A(r,i)}),i}function A(t,s){return t.forEach(n=>s.add(n)),s}function I(t,s,n){const i=new Set,e=[];if(y(s,(o,r)=>{if(m(o,r)){e.push(T.genRule(o,r));return}const c=u(t,r??{},n);A(c,i)}),!n.scopeClassName)return i;if(e.length){const o=e.join(" ");t.append(`${p(n.preconditions,{right:n.scopeClassName})} {${o}}`)}return i.add(n.scopeClassName),i}function L(t,s,n,i){t.append(n+" {");const e=u(t,s,i);return t.append("}"),e}export{H as a,Q as c};
