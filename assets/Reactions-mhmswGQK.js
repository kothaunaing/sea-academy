import{j as s,h as T,u as $,r as a,A as S,c as k,b as r,d as C,E as L,F as j,V as F,aT as B,Y as O,aF as R,aV as D,aI as E,aW as V}from"./index-bR4MaZOJ.js";import{n as q}from"./notify-kdn7sAoT.js";import{T as A}from"./Tooltip-jKN6Sqwz.js";import{I as H}from"./IconButton-zFeYIEAO.js";import{F as N,a as M}from"./FavoriteBorder-gZEnJaMG.js";import{c as P}from"./createSvgIcon-3G1Z23-M.js";const U=P(s.jsx("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H6l-2 2V4h16z"}),"ChatBubbleOutline"),ss=({post:l,collectionName:c})=>{const{id:n}=l;T().palette;const m=$(),[p,g]=a.useState(null),[u,v]=a.useState(null),{userId:x}=a.useContext(S),[y,Y]=a.useState(!1),[I,G]=a.useState(!1),t=c==="posts";k(r(C,c,n),"comments");const w=k(r(C,c,n),"likes"),[d,f]=a.useState(!1),h=async(e,o)=>{const i=k(r(C,c,n),e);console.log("Fetching counts...");const z=await V(i);o(z.data().count)};a.useEffect(()=>{(async()=>{await h("likes",g),await h("comments",v)})()},[]),a.useEffect(()=>{(async()=>{const o=F(w,B("uid","==",x)),i=await O(o);f(!i.empty)})()},[]);const b=async()=>{try{const e=async()=>{await h("likes",g)},o=r(w,x),i={uid:x,timestamp:R()};d?(f(!1),await E(o),e()):(f(!0),await D(o,i),e(),q(["like",t?"post":"test"],t?"description":"testName",t?l.description:l.name,null,n))}catch(e){console.log(e.message)}};return s.jsxs("div",{className:"mt-2",children:[s.jsxs(L,{className:"transition-all mb-1 flex justify-between pl-2 pr-2",children:[s.jsx(j,{size:"small",sx:{textDecoration:"underline",textTransform:"capitalize"},variant:y?"outlined":"text",onClick:()=>{m(`/app/${t?"posts":"tests"}/${t?"sp":"st"}/${n}`)},children:s.jsxs("span",{children:[p||0," ",p>1?"Likes":"Like"]})}),s.jsxs(j,{size:"small",variant:I?"outlined":"text",sx:{textDecoration:"underline",textTransform:"capitalize"},onClick:()=>{m(`/app/${t?"posts":"tests"}/${t?"sp":"st"}/${n}`)},children:[u||0," ",u>1?"Comments":"Comment"]})]}),s.jsxs(L,{className:"p-2 shadow-lg border-t pt-2 flex gap-x-2",children:[s.jsx(A,{title:d?"Unlike":"Like",arrow:!0,children:s.jsx(H,{color:"error",size:"small",sx:{textTransform:"capitalize"},onClick:b,children:d?s.jsx(N,{}):s.jsx(M,{})})}),s.jsx(j,{size:"small",sx:{textTransform:"capitalize"},onClick:()=>{m(`/app/${t?"posts":"tests"}/${t?"sp":"st"}/${n}`)},startIcon:s.jsx(U,{}),children:"Comment"})]})]})};export{ss as R};
