import{r as t,A as J,u as K,h as X,c as Y,b as Z,O as _,Q as ee,j as e,I as te,f as C,E as se,d as oe,S as L,U as ae,V as re,W as ie}from"./index-14pqm9y1.js";import{C as E}from"./ConfirmDelete-RLdVewKK.js";import{L as ne}from"./LoadingScreen-EYXdXKre.js";import{M as H}from"./EmptyComponent-LbBV4xaA.js";import{S as le}from"./SkeletonHistory-hez_RTB7.js";import{B as ce}from"./Button-dux8T5OH.js";import"./Dialog-7UnCDBMC.js";import"./Modal-XJP-E1k3.js";import"./Portal-YB56xSUH.js";import"./Typography-F2i8tb5R.js";import"./Stack-bBqHnaWs.js";import"./Skeleton-aRLWJJ7b.js";import"./ButtonBase-ryrwXNwG.js";const be=()=>{const{deleteFromHistory:a,setHeaderTitle:n,userId:c,historyCount:x}=t.useContext(J),d=K(),[r,p]=t.useState([]),[D,g]=t.useState(null),[$,m]=t.useState(!1),[k,l]=t.useState(!1),[A,B]=t.useState(!1),[u,M]=t.useState([]),T=X(),{mode:h}=T.palette,R=Y(Z(oe,"users",c),"history"),[y,f]=t.useState(!0),[V,w]=t.useState(!1),[S,z]=t.useState(null),[P,Q]=t.useState(!0),[j,q]=t.useState(0),[v,F]=t.useState(null),I=8,N=async()=>{f(!0);let s=L(R,ae(I));v&&(s=L(s,re(v)));try{const o=await ie(s);if(o.empty)w(!0);else{const i=o.docs.map(b=>({id:b.id,...b.data()}));p([...r,...i]),F(o.docs[o.docs.length-1]),C(f),q(j+1),i.length<I&&Q(!1)}}catch(o){const i="Error fetching history: "+o.message;console.log(i),f(!1),z(i)}};t.useEffect(()=>{N()},[]);const O=s=>{A||d(`/app/history/${s.id}`)},U=()=>{a(D),g(null),m(!1)},W=()=>{m(!1),g(null)},G=()=>{const s=r.filter(o=>!u.includes(o.id));p(s),M([]),l(!1),B(!1)};return _("history-page"),ee("history-page"),t.useEffect(()=>{n("History")},[]),y&&j===0?e.jsx(ne,{isLoading:y,text:"Loading history..."}):V?e.jsx(H,{text:"No items available"}):S?e.jsx(H,{text:S}):e.jsxs("div",{className:"m-2",children:[e.jsx(E,{data:{value:k,setValue:l,text:`Are you sure to delete ${u.length} ${u.length<=1?"item":"items"} ?`,yesButton:G,noButton:()=>l(!1),setValue:l}}),e.jsx(E,{data:{value:$,text:"Are you sure to delete ?",yesButton:U,noButton:W,setValue:m}}),e.jsxs("div",{className:`grid border  rounded-md shadow-md ${h==="dark"?"border-slate-700":"border-slate-200"}`,children:[r.map((s,o)=>e.jsx(de,{h:s,index:o,goToResults:O,mode:h},`history-item-${s.id}`)),P?e.jsx("div",{className:"flex justify-center mt-1 mb-2 ",children:e.jsx(ce,{size:"small",onClick:N,children:"load more"})}):""]})]})},de=te.memo(({h:a,index:n,goToResults:c,mode:x})=>{const[d,r]=t.useState(!0);return C(r,2e3),d?e.jsx(le,{}):e.jsxs(se,{onClick:()=>c(a,n),className:`min-h-20 p-2 border-t  cursor-pointer ${n===0&&"border-t-0"} gap-x-3 ${x==="dark"?"border-slate-700":"border-slate-200"} `,children:[e.jsx("div",{className:"font-medium",children:a.testName}),e.jsx("div",{className:"p-2 flex items-center gap-x-2",children:e.jsx("div",{className:"flex flex-1 items-center gap-x-3",children:e.jsxs("div",{className:"flex-1 sm:flex items-center gap-x-3 ",children:[e.jsxs("div",{className:"",children:["Score: ",a.score," / ",a.results.length," "]}),e.jsxs("div",{className:" ",children:["Date: ",a.date," (",` ${a.time}`,")"]})]})})})]})});export{be as default};
