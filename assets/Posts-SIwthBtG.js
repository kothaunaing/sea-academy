import{j as e,h as B,u as F,r as t,A as O,c as T,b,d as E,E as u,S as z,aP as P,W as M,aC as R,aR as V,aF as U,aS as H,I as q,aG as G,O as Q,U as W,aI as Y,V as J,f as K}from"./index-dSD7UM6z.js";import{s as X}from"./sortByDateNewer-X-Bb2bKS.js";import{L as Z}from"./LoadingScreen-BgP5KCQC.js";import{I as _}from"./ImageViewer-jQeWf4UN.js";import{p as ee}from"./prettyDate-uNOGf4QX.js";import{f as se}from"./fixTime-t8Fgsaat.js";import{I as te,F as oe,L as ae}from"./Links-XSrInvf8.js";import{n as ie}from"./notify-Jx9imYkB.js";import{B as $}from"./Button-ZTLNkO5Z.js";import{T as D}from"./Tooltip-pmR5sMk3.js";import{I as ne}from"./IconButton-M8OEfqkq.js";import{F as re,a as ce}from"./FavoriteBorder-HxMcdhth.js";import{c as le}from"./createSvgIcon-5tUNT3Hd.js";import{S as me}from"./SkeletonPost-UN4bfPcr.js";import{M as pe}from"./MoreOption-JHeiK-L2.js";import{E as ue}from"./EditSharp-5MWA8YtH.js";import{T as N}from"./Typography-GbCp5BvV.js";import{L as de}from"./LinkSharp-QhDPgRCi.js";import{G as fe}from"./Grid-GwN7kgyx.js";import{M as A}from"./EmptyComponent-exm26pmt.js";import{F as xe}from"./FabSearch-alGNTd9W.js";import"./Dialog-mGbZrOYD.js";import"./Modal-40Myj6Vm.js";import"./Portal-nV2JPNiI.js";import"./Stack-4mDqqL4m.js";import"./CloseSharp-rElFupoQ.js";import"./ButtonBase-D-lMm-wW.js";import"./useControlled-ajujHaEs.js";import"./Skeleton-dIugF2Xi.js";import"./OtherActions-nqepKyeg.js";import"./getImage-SzyEh5nT.js";import"./Fab-Vc2rsHLm.js";import"./SearchSharp-Oy0ZvDJ_.js";const he=le(e.jsx("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H6l-2 2V4h16z"}),"ChatBubbleOutline"),ge=({post:s,collectionName:m})=>{const{id:r}=s;B().palette;const l=F(),[o,x]=t.useState(null),[d,h]=t.useState(null),{userId:g}=t.useContext(O),[p,y]=t.useState(!1),[f,j]=t.useState(!1),n=m==="posts";T(b(E,m,r),"comments");const L=T(b(E,m,r),"likes"),[k,C]=t.useState(!1),S=async(a,i)=>{const c=T(b(E,m,r),a);console.log("Fetching counts...");const v=await H(c);i(v.data().count)};t.useEffect(()=>{(async()=>{await S("likes",x),await S("comments",h)})()},[]),t.useEffect(()=>{(async()=>{const i=z(L,P("uid","==",g)),c=await M(i);C(!c.empty)})()},[]);const I=async()=>{try{const a=async()=>{await S("likes",x)},i=b(L,g),c={uid:g,timestamp:R()};k?(C(!1),await U(i),a()):(C(!0),await V(i,c),a(),ie(["like",n?"post":"test"],n?"description":"testName",n?s.description:s.name,null,r))}catch(a){console.log(a.message)}};return e.jsxs("div",{className:"mt-2",children:[e.jsxs(u,{className:"transition-all mb-1 flex justify-between pl-2 pr-2",children:[e.jsx($,{size:"small",sx:{textDecoration:"underline",textTransform:"capitalize"},variant:p?"outlined":"text",onClick:()=>{l(`/app/${n?"posts":"tests"}/${n?"sp":"st"}/${r}`)},children:e.jsxs("span",{children:[o||0," ",o>1?"Likes":"Like"]})}),e.jsxs($,{size:"small",variant:f?"outlined":"text",sx:{textDecoration:"underline",textTransform:"capitalize"},onClick:()=>{l(`/app/${n?"posts":"tests"}/${n?"sp":"st"}/${r}`)},children:[d||0," ",d>1?"Comments":"Comment"]})]}),e.jsxs(u,{className:"p-2 shadow-lg border-t pt-2 flex gap-x-2",children:[e.jsx(D,{title:k?"Unlike":"Like",arrow:!0,children:e.jsx(ne,{color:"error",size:"small",sx:{textTransform:"capitalize"},onClick:I,children:k?e.jsx(re,{}):e.jsx(ce,{})})}),e.jsx($,{size:"small",sx:{textTransform:"capitalize"},onClick:()=>{l(`/app/${n?"posts":"tests"}/${n?"sp":"st"}/${r}`)},startIcon:e.jsx(he,{}),children:"Comment"})]})]})},je=q.memo(({post:s,setViewingImage:m})=>{var f,j;const{users:r,openSnackbar:w,userData:l}=t.useContext(O),[o,x]=t.useState(null),[d,h]=t.useState(!0);B().palette;const p=F(),y=l!=null&&l.isAdmin?{text:"Edit Post",icon:e.jsx(ue,{}),onClick:()=>{p("/app/admin/posts/")}}:null;return G(s.uid,r,x,h,[],1200),d?e.jsx(me,{}):e.jsxs(u,{bgcolor:"background.default",color:"text.primary",className:"border border-slate-300 shadow-lg rounded-md",sx:{width:"full"},children:[e.jsxs(u,{className:"top-section flex justify-between  mb-2 p-2",children:[e.jsxs(u,{className:"flex gap-x-2",children:[e.jsx(D,{title:`View ${o&&o.name}'s profile`,arrow:!0,placement:"top",children:e.jsx("div",{className:"cursor-pointer",onClick:()=>p(`/app/profile/${o.uid}`),children:e.jsx("img",{className:"size-10 rounded-full shadow-md object-cover cursor-pointer",src:o?o.image:"images/sea-logo.jpg"})})}),e.jsxs(u,{children:[e.jsx(D,{title:`View ${o&&o.name}'s profile`,arrow:!0,placement:"top",children:e.jsx(N,{onClick:()=>p(`/app/profile/${o.uid}`),variant:"h6",fontSize:"1rem",sx:{cursor:"pointer"},children:o?o.name:"Unknown User"})}),e.jsx(N,{variant:"caption",children:ee(se(s.time))})]})]}),e.jsx(u,{children:e.jsx(pe,{options:[{text:"Copy link",icon:e.jsx(de,{}),onClick:()=>{const n=`${location.origin}/#/app/posts/sp/${s.id}`;navigator.clipboard.writeText(n),w("Link copied successfully")}},y],isComment:!0})})]}),(s==null?void 0:s.description)&&e.jsx(N,{p:1,children:s.description}),s.images.length!==0?e.jsx(fe,{container:!0,spacing:1,className:" p-0",sx:{p:1},children:e.jsx(te,{post:s,setViewingImage:m})}):"",s.files&&((f=s==null?void 0:s.files)==null?void 0:f.length)!==0&&e.jsx(oe,{files:s.files}),(s==null?void 0:s.links)&&((j=s==null?void 0:s.links)==null?void 0:j.length)!==0&&e.jsx(ae,{links:s.links}),e.jsx(ge,{post:s,collectionName:"posts"})]})}),Ze=()=>{const{setHeaderTitle:s}=t.useContext(O),[m,r]=t.useState([]);F();const w=T(E,"posts"),[l,o]=t.useState(!0),[x,d]=t.useState(!1),[h,g]=t.useState(null),[p,y]=t.useState(0),[f,j]=t.useState(null),[n,L]=t.useState(!0),k=6,[C,S]=t.useState(null);t.useEffect(()=>{s("STAR EDUCATION ACADEMY")},[]);const I=async()=>{o(!0);let a=z(w,Y("time","desc"),W(k));C&&(a=z(a,J(C)));try{const i=await M(a);if(i.empty)d(!0);else{const c=i.docs.map(v=>({id:v.id,...v.data()}));r([...m,...c]),S(i.docs[i.docs.length-1]),K(o),y(p+1),c.length<k&&L(!1)}}catch(i){const c="Error fetching posts: "+i.message;console.log(c),o(!1),g(c)}};return t.useEffect(()=>{I()},[]),Q("posts-page"),l&&p===0?e.jsx(Z,{isLoading:l,text:"Loading posts..."}):x?e.jsx(A,{text:"No posts available"}):h?e.jsx(A,{text:h}):e.jsxs(u,{children:[e.jsx(xe,{}),e.jsxs("div",{className:"grid gap-y-6 m-2",children:[f&&e.jsx(_,{image:f,setViewingImage:j,postImage:!0}),m.sort((a,i)=>X(a,i,"time","newer")).map(a=>e.jsx(je,{setViewingImage:j,post:a},a.id))]}),n?e.jsx("div",{className:"flex justify-center mt-1 mb-2 ",children:e.jsx($,{size:"small",onClick:I,children:"load more"})}):""]})};export{Ze as default};
