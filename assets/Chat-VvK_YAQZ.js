import{j as t,K as X,r as a,A as z,u as ce,aZ as Ze,aJ as G,G as T,E as R,h as ee,a as lt,b as E,c as O,d as V,aN as le,aF as fe,aV as Re,aI as ge,aA as Ie,aC as ut,aD as dt,az as oe,V as je,W as ye,aT as mt,Y as Pe,M as ht,F as xe,a_ as Te,aG as ie,s as Rt,S as It,U as Tt,aO as Lt,aP as Ut,aQ as Ot,aR as Zt,aS as Pt,aM as rt,X as Vt,aK as Ht,N as Gt,aE as Wt,aU as Yt,aB as at}from"./index-bR4MaZOJ.js";import{P as re}from"./ProfilePicture-NkVAKawu.js";import{s as ue}from"./sortByDateNewer-X-Bb2bKS.js";import{S as Ve}from"./SkeletonUser-pwlHAotJ.js";import{T as k}from"./Tooltip-jKN6Sqwz.js";import{i as _t}from"./browser-image-compression-9kymdGFS.js";import{A as qt,T as Jt}from"./Toolbar-hGYTZVqC.js";import{I as W}from"./IconButton-zFeYIEAO.js";import{c as we}from"./createSvgIcon-3G1Z23-M.js";import{S as H}from"./Skeleton-LRfmB9RD.js";import{E as pt}from"./EditSharp-tls7Gpwf.js";import{T as ft}from"./TextField-lZjHCUEq.js";import{S as Qt}from"./SaveSharp-jivs753Y.js";import{D as xt}from"./DeleteSharp-n4xHhV2L.js";import{A as Kt}from"./AddSharp-TtdqpAmB.js";import{g as He}from"./shortenText-S284lLsL.js";import{f as De}from"./fixTime-t8Fgsaat.js";import{g as Ge}from"./getImage-SzyEh5nT.js";import{V as Xt}from"./VisibilitySharp-1EWBzGLv.js";import{M as es,O as ts}from"./OtherActions-7net_NKU.js";import{I as ss}from"./ImageViewer-gTpVmIgl.js";import{D as We}from"./Dialog-pOjzfPCd.js";import{L as ns}from"./LoadingScreen-yCIU47i-.js";import{M as Me}from"./EmptyComponent-mtutYQst.js";import{F as rs}from"./Fab-Obg5aW--.js";import{C as it}from"./CloseSharp-8hnKeMD4.js";import{C as as}from"./CollectionsSharp-YB0-lM5W.js";import"./Portal-vj8E7tuN.js";import"./useControlled-Tg6WpoLH.js";import"./Modal-AMyV4m0Z.js";import"./debounce-gOEKrWSg.js";import"./Stack-WYlN-LHL.js";const is=we(t.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),os=we(t.jsx("path",{d:"m20 12-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8z"}),"ArrowDownward"),cs=we(t.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11"}),"ReplySharp"),ls=we(t.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),us=({members:s})=>t.jsxs("div",{className:"p-2 grid gap-y-2 ",children:[t.jsx("p",{className:"text-lg font-bold",children:"Members"}),t.jsx(R,{className:"border rounded-md shadow-lg border-slate-200",children:s.sort((e,n)=>ue(e,n,"joinedAt","newer")).map((e,n)=>t.jsx("div",{className:`p-2 flex gap-x-2 items-center border-t ${s.length===n&&"border-b"} ${n===0&&"border-t-0"}`,children:t.jsx(ds,{member:e})},e.uid+e.joinedAt))})]}),ds=X.memo(({member:s})=>{const{users:e}=a.useContext(z),[n,r]=a.useState(null),[o,l]=a.useState(!0),[u,i]=a.useState("offline"),[c,d]=a.useState(null),h=ce();Ze(s.uid,i,d),G(s.uid,e,r,l);const x=()=>{h(`/app/profile/${n==null?void 0:n.uid}`)};return o?t.jsx(Ve,{}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"relative",children:[t.jsx(k,{arrow:!0,placement:"top",title:`View ${n==null?void 0:n.name}'s profile`,children:t.jsx("div",{onClick:x,className:"cursor-pointer",children:t.jsx(re,{image:n==null?void 0:n.image,name:n==null?void 0:n.name})})}),t.jsx("div",{className:"size-[16px] bg-white rounded-full flex justify-center items-center absolute bottom-0 right-0",children:t.jsx("div",{className:` size-3 rounded-full ${u==="online"?"bg-green-500":"bg-gray-500"}`})})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx(k,{arrow:!0,placement:"top",title:`View ${n==null?void 0:n.name}'s profile`,children:t.jsxs(T,{onClick:x,sx:{cursor:"pointer"},variant:"h6",fontSize:"0.9rem",children:[n==null?void 0:n.name," ",n!=null&&n.isAdmin?t.jsx(T,{variant:"caption",children:"(admin)"}):""]})}),t.jsx("p",{className:`text-sm ${u==="online"?"text-blue-500":"text-gray-500"}`,children:u==="online"?"Online":c})]})]})}),gt=X.memo(({pageName:s,setSubPage:e,currentChat:n,infoPage:r,memberCounts:o,onlineUsers:l})=>{var d;const u=ce(),i=ee(),{mode:c}=i.palette;return t.jsx(qt,{sx:{backgroundColor:c==="dark"?"background.default":"white",color:"text.primary"},children:t.jsxs(Jt,{className:`h-[70px] z-30 p-2 min-h-10 pb-2 flex items-center justify-between gap-x-1 ${c==="dark"?"border-slate-700":"border-slate-200"} border-b `,children:[t.jsxs("div",{className:"flex items-center gap-x-1",children:[t.jsx("div",{children:t.jsx(k,{title:"Navigate up",arrow:!0,children:t.jsx(W,{onClick:()=>{r?e(s):u("/app/chatroom")},children:t.jsx(is,{})})})}),t.jsxs("div",{onClick:()=>e(s),className:"cursor-pointer",children:[t.jsx(T,{variant:"h6",fontSize:"1.1rem",children:n==null?void 0:n.name}),t.jsxs("div",{className:"flex items-center",children:[o?t.jsxs("p",{className:"text-sm ",children:[o," ",o<=1?"member":"members"]}):t.jsx(H,{height:40,width:100}),l?t.jsxs(T,{variant:"caption",children:[", "," ",l," online"]}):t.jsx(H,{height:40,width:60})]})]})]}),t.jsx("button",{onClick:()=>e(s),children:t.jsx("img",{src:((d=n==null?void 0:n.image)==null?void 0:d.URL)||"images/sea-logo.jpg",alt:n==null?void 0:n.name,className:"size-12 rounded-full object-center object-cover "})})]})})}),ms=X.memo(({setSubPage:s,currentChat:e,memberCounts:n,setMemberCounts:r,members:o,setMembers:l,onlineUsers:u})=>{var v;const{chatId:i}=lt(),{users:c,userData:d}=a.useContext(z);ee().palette;const x=E(V,"chats",i),[y,g]=a.useState(""),[D,$]=a.useState(null),F=E(V,"chats",i),b=O(F,"members");a.useEffect(()=>{g(e.name)},[e]);const C=_=>{let p=!1;return o.forEach(A=>{A.uid===_&&(p=!0)}),p},B=async _=>{let p=!1;const A=je(b,mt("uid","==",_),ye(1));return console.log("Checking if a member..."),p=!(await Pe(A)).empty,p};a.useEffect(()=>le(b,I=>{I.empty||((async()=>await ht(b,r))(),l(I.docs.map(L=>({...L.data(),id:L.id}))))}),[]);const Y=async _=>{try{const p=E(b,_);await B(_)||await Re(p,{uid:_,joinedAt:fe()})}catch(p){console.log(p.message)}},w=async _=>{try{const p=E(b,_);await ge(p)}catch(p){console.log(p.message)}},te=async()=>{if(!D)return;const _=`chats/${e.id}/groupImage-${D.name}`,p=Ie(storage,_),A=await _t(D,{maxSizeMB:.5,maxWidthOrHeight:1280,useWebWorker:!0}),I=await ut(p,A),J=await dt(I.ref),L={name:D.name,path:_,URL:J,size:A.size};await oe(x,{image:L})},q=async()=>{y.trim()&&await oe(x,{name:y})};if(a.useEffect(()=>{te()},[D]),a.useEffect(()=>{scrollTo({top:0})},[]),e)return t.jsxs("div",{className:"",children:[t.jsx(gt,{pageName:"chat",infoPage:!0,setSubPage:s,currentChat:e,memberCounts:n,onlineUsers:u}),(d==null?void 0:d.isAdmin)&&t.jsxs(R,{className:"p-2 m-1 mt-4 shadow-md border rounded-md border-slate-200",children:[t.jsx("input",{id:"imageInput",className:"hidden",type:"file",accept:"image/*",onChange:_=>$(_.target.files[0])}),t.jsxs("div",{className:"relative size-24",children:[t.jsx("img",{src:((v=e==null?void 0:e.image)==null?void 0:v.URL)||"images/sea-logo.jpg",className:"size-24 rounded-full object-cover object-center bg-cover"}),t.jsx("label",{htmlFor:"imageInput",className:" p-1 size-7 rounded-full absolute -bottom-1 -right-1 cursor-pointer ",children:t.jsx(pt,{fontSize:"15px"})})]}),t.jsxs("div",{className:"mt-2 ",children:[t.jsx("p",{children:"Group Name"}),t.jsxs("div",{className:"flex gap-x-2 items-center",children:[t.jsx(ft,{size:"small",value:y,onChange:_=>g(_.target.value),placeholder:"Enter group name..."}),t.jsx(W,{size:"small",onClick:q,children:t.jsx(Qt,{fontSize:"18px"})})]})]})]}),o&&t.jsx(us,{members:o}),(d==null?void 0:d.isAdmin)&&t.jsxs("div",{className:"p-2 grid gap-y-2 ",children:[t.jsx("p",{className:"text-lg font-bold",children:"Manage Members"}),t.jsx(R,{className:"border rounded-md shadow-lg border-slate-200",children:c.sort((_,p)=>ue(_,p,"createdAt","newer")).map((_,p)=>t.jsx(hs,{user:_,i:p,members:o,addMember:Y,removeMember:w,isAMember:C},_.name+" "+_.image+p))})]})]})}),hs=X.memo(({user:s,i:e,members:n,isAMember:r,removeMember:o,addMember:l})=>{const[u,i]=a.useState("offline"),[c,d]=a.useState(null),h=ce();Ze(s.uid,i,d);const x=()=>{h(`/app/profile/${s==null?void 0:s.uid}`)};return t.jsxs("div",{className:`p-2 flex justify-between gap-x-2 items-center border-t border-slate-200 ${(n==null?void 0:n.length)===e&&"border-b"} ${e===0&&"border-t-0"} `,children:[t.jsxs("div",{className:"flex gap-x-2 items-center",children:[t.jsxs("div",{className:"relative",children:[t.jsx(k,{arrow:!0,placement:"top",title:`View ${s==null?void 0:s.name}'s profile`,children:t.jsx("div",{onClick:x,className:"cursor-pointer",children:t.jsx(re,{image:s==null?void 0:s.image,name:s==null?void 0:s.name})})}),t.jsx("div",{className:"size-[16px] bg-white rounded-full flex justify-center items-center absolute bottom-0 right-0",children:t.jsx("div",{className:` size-3 rounded-full ${u==="online"?"bg-green-500":"bg-gray-500"}`})})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx(k,{arrow:!0,placement:"top",title:`View ${s==null?void 0:s.name}'s profile`,children:t.jsx(T,{onClick:x,sx:{cursor:"pointer"},variant:"h6",fontSize:"0.9rem",children:s==null?void 0:s.name})}),t.jsx("p",{className:`text-sm ${u==="online"?"text-blue-500":"text-gray-500"}`,children:u==="online"?"Online":c})]})]}),t.jsx("div",{children:r(s.uid)?!s.isAdmin&&t.jsx(k,{title:`Remove ${s.name}`,arrow:!0,placement:"left",children:t.jsx(W,{size:"small",onClick:()=>o(s.uid),children:t.jsx(xt,{})})}):t.jsx(k,{title:`Add ${s.name}`,arrow:!0,placement:"left",children:t.jsx(W,{size:"small",onClick:()=>l(s.uid),children:t.jsx(Kt,{})})})})]})}),_s=[{name:"like",image:"facebookLike"},{name:"love",image:"facebookLove"},{name:"haha",image:"facebookHaha"},{name:"wow",image:"facebookWow"},{name:"sad",image:"facebookSad"},{name:"angry",image:"facebookAngry"}],ps=({chatId:s,message:e,setReactedUsers:n})=>{a.useState(!1);const[r,o]=a.useState([]),l=O(E(O(E(V,"chats",s),"messages"),e.id),"reactedBy"),{userId:u}=a.useContext(z),i=ee(),{mode:c}=i.palette,d=()=>le(l,D=>{if(D.empty)o([]);else{const $=D.docs.map(F=>F.data());o($)}});a.useEffect(()=>{const g=d();return()=>{g&&g()}},[]);const h=async()=>{const g=E(l,u);await ge(g)},x=g=>{let D=!1;return r.forEach($=>{$.reactionType===g&&(D=!0)}),D},y=_s.filter(g=>x(g.name));if(r.length!==0)return t.jsx("div",{children:t.jsx(k,{arrow:!0,title:r.length===1?"1 reaction":`${r.length} reactions`,children:t.jsxs("button",{onClick:()=>n({reactedBy:r,removeReaction:h}),className:`mt-2 border ${c==="light"?"border-slate-200 ":"border-slate-700"}  p-1 rounded-lg flex justify-center items-center text-sm`,children:[y.map((g,D)=>t.jsx("img",{className:"w-4 ml-[-3px]",src:Ge(g.image)},`reaction-${g.name}-${D}`)),t.jsx("span",{className:"ml-1",children:r.length})]})})})};function Le(s){return new Date(s).toLocaleTimeString([],{hour:"numeric",minute:"numeric",hour12:!0})}const fs=/[\0-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,xs=/[\0-\x1F\x7F-\x9F]/,gs=/[!-#%-\*,-\/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061D-\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1B7D\u1B7E\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52-\u2E5D\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59\uDF86-\uDF89]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDEB9\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2\uDF00-\uDF09]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDF43-\uDF4F\uDFFF]|\uD809[\uDC70-\uDC74]|\uD80B[\uDFF1\uDFF2]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/,js=/[ \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/;function ys(s){const e={};s=s||{},e.src_Any=fs.source,e.src_Cc=xs.source,e.src_Z=js.source,e.src_P=gs.source,e.src_ZPCc=[e.src_Z,e.src_P,e.src_Cc].join("|"),e.src_ZCc=[e.src_Z,e.src_Cc].join("|");const n="[><｜]";return e.src_pseudo_letter="(?:(?!"+n+"|"+e.src_ZPCc+")"+e.src_Any+")",e.src_ip4="(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)",e.src_auth="(?:(?:(?!"+e.src_ZCc+"|[@/\\[\\]()]).)+@)?",e.src_port="(?::(?:6(?:[0-4]\\d{3}|5(?:[0-4]\\d{2}|5(?:[0-2]\\d|3[0-5])))|[1-5]?\\d{1,4}))?",e.src_host_terminator="(?=$|"+n+"|"+e.src_ZPCc+")(?!"+(s["---"]?"-(?!--)|":"-|")+"_|:\\d|\\.-|\\.(?!$|"+e.src_ZPCc+"))",e.src_path="(?:[/?#](?:(?!"+e.src_ZCc+"|"+n+`|[()[\\]{}.,"'?!\\-;]).|\\[(?:(?!`+e.src_ZCc+"|\\]).)*\\]|\\((?:(?!"+e.src_ZCc+"|[)]).)*\\)|\\{(?:(?!"+e.src_ZCc+'|[}]).)*\\}|\\"(?:(?!'+e.src_ZCc+`|["]).)+\\"|\\'(?:(?!`+e.src_ZCc+"|[']).)+\\'|\\'(?="+e.src_pseudo_letter+"|[-])|\\.{2,}[a-zA-Z0-9%/&]|\\.(?!"+e.src_ZCc+"|[.]|$)|"+(s["---"]?"\\-(?!--(?:[^-]|$))(?:-*)|":"\\-+|")+",(?!"+e.src_ZCc+"|$)|;(?!"+e.src_ZCc+"|$)|\\!+(?!"+e.src_ZCc+"|[!]|$)|\\?(?!"+e.src_ZCc+"|[?]|$))+|\\/)?",e.src_email_name='[\\-;:&=\\+\\$,\\.a-zA-Z0-9_][\\-;:&=\\+\\$,\\"\\.a-zA-Z0-9_]*',e.src_xn="xn--[a-z0-9\\-]{1,59}",e.src_domain_root="(?:"+e.src_xn+"|"+e.src_pseudo_letter+"{1,63})",e.src_domain="(?:"+e.src_xn+"|(?:"+e.src_pseudo_letter+")|(?:"+e.src_pseudo_letter+"(?:-|"+e.src_pseudo_letter+"){0,61}"+e.src_pseudo_letter+"))",e.src_host="(?:(?:(?:(?:"+e.src_domain+")\\.)*"+e.src_domain+"))",e.tpl_host_fuzzy="(?:"+e.src_ip4+"|(?:(?:(?:"+e.src_domain+")\\.)+(?:%TLDS%)))",e.tpl_host_no_ip_fuzzy="(?:(?:(?:"+e.src_domain+")\\.)+(?:%TLDS%))",e.src_host_strict=e.src_host+e.src_host_terminator,e.tpl_host_fuzzy_strict=e.tpl_host_fuzzy+e.src_host_terminator,e.src_host_port_strict=e.src_host+e.src_port+e.src_host_terminator,e.tpl_host_port_fuzzy_strict=e.tpl_host_fuzzy+e.src_port+e.src_host_terminator,e.tpl_host_port_no_ip_fuzzy_strict=e.tpl_host_no_ip_fuzzy+e.src_port+e.src_host_terminator,e.tpl_host_fuzzy_test="localhost|www\\.|\\.\\d{1,3}\\.|(?:\\.(?:%TLDS%)(?:"+e.src_ZPCc+"|>|$))",e.tpl_email_fuzzy="(^|"+n+'|"|\\(|'+e.src_ZCc+")("+e.src_email_name+"@"+e.tpl_host_fuzzy_strict+")",e.tpl_link_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|｜]|"+e.src_ZPCc+"))((?![$+<=>^`|｜])"+e.tpl_host_port_fuzzy_strict+e.src_path+")",e.tpl_link_no_ip_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|｜]|"+e.src_ZPCc+"))((?![$+<=>^`|｜])"+e.tpl_host_port_no_ip_fuzzy_strict+e.src_path+")",e}function Ue(s){return Array.prototype.slice.call(arguments,1).forEach(function(n){n&&Object.keys(n).forEach(function(r){s[r]=n[r]})}),s}function Fe(s){return Object.prototype.toString.call(s)}function Ds(s){return Fe(s)==="[object String]"}function bs(s){return Fe(s)==="[object Object]"}function ws(s){return Fe(s)==="[object RegExp]"}function ot(s){return Fe(s)==="[object Function]"}function Fs(s){return s.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}const jt={fuzzyLink:!0,fuzzyEmail:!0,fuzzyIP:!1};function vs(s){return Object.keys(s||{}).reduce(function(e,n){return e||jt.hasOwnProperty(n)},!1)}const Ss={"http:":{validate:function(s,e,n){const r=s.slice(e);return n.re.http||(n.re.http=new RegExp("^\\/\\/"+n.re.src_auth+n.re.src_host_port_strict+n.re.src_path,"i")),n.re.http.test(r)?r.match(n.re.http)[0].length:0}},"https:":"http:","ftp:":"http:","//":{validate:function(s,e,n){const r=s.slice(e);return n.re.no_http||(n.re.no_http=new RegExp("^"+n.re.src_auth+"(?:localhost|(?:(?:"+n.re.src_domain+")\\.)+"+n.re.src_domain_root+")"+n.re.src_port+n.re.src_host_terminator+n.re.src_path,"i")),n.re.no_http.test(r)?e>=3&&s[e-3]===":"||e>=3&&s[e-3]==="/"?0:r.match(n.re.no_http)[0].length:0}},"mailto:":{validate:function(s,e,n){const r=s.slice(e);return n.re.mailto||(n.re.mailto=new RegExp("^"+n.re.src_email_name+"@"+n.re.src_host_strict,"i")),n.re.mailto.test(r)?r.match(n.re.mailto)[0].length:0}}},Es="a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvwxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvxyz]|t[cdfghjklmnortvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]",zs="biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|рф".split("|");function Cs(s){s.__index__=-1,s.__text_cache__=""}function As(s){return function(e,n){const r=e.slice(n);return s.test(r)?r.match(s)[0].length:0}}function ct(){return function(s,e){e.normalize(s)}}function be(s){const e=s.re=ys(s.__opts__),n=s.__tlds__.slice();s.onCompile(),s.__tlds_replaced__||n.push(Es),n.push(e.src_xn),e.src_tlds=n.join("|");function r(i){return i.replace("%TLDS%",e.src_tlds)}e.email_fuzzy=RegExp(r(e.tpl_email_fuzzy),"i"),e.link_fuzzy=RegExp(r(e.tpl_link_fuzzy),"i"),e.link_no_ip_fuzzy=RegExp(r(e.tpl_link_no_ip_fuzzy),"i"),e.host_fuzzy_test=RegExp(r(e.tpl_host_fuzzy_test),"i");const o=[];s.__compiled__={};function l(i,c){throw new Error('(LinkifyIt) Invalid schema "'+i+'": '+c)}Object.keys(s.__schemas__).forEach(function(i){const c=s.__schemas__[i];if(c===null)return;const d={validate:null,link:null};if(s.__compiled__[i]=d,bs(c)){ws(c.validate)?d.validate=As(c.validate):ot(c.validate)?d.validate=c.validate:l(i,c),ot(c.normalize)?d.normalize=c.normalize:c.normalize?l(i,c):d.normalize=ct();return}if(Ds(c)){o.push(i);return}l(i,c)}),o.forEach(function(i){s.__compiled__[s.__schemas__[i]]&&(s.__compiled__[i].validate=s.__compiled__[s.__schemas__[i]].validate,s.__compiled__[i].normalize=s.__compiled__[s.__schemas__[i]].normalize)}),s.__compiled__[""]={validate:null,normalize:ct()};const u=Object.keys(s.__compiled__).filter(function(i){return i.length>0&&s.__compiled__[i]}).map(Fs).join("|");s.re.schema_test=RegExp("(^|(?!_)(?:[><｜]|"+e.src_ZPCc+"))("+u+")","i"),s.re.schema_search=RegExp("(^|(?!_)(?:[><｜]|"+e.src_ZPCc+"))("+u+")","ig"),s.re.schema_at_start=RegExp("^"+s.re.schema_search.source,"i"),s.re.pretest=RegExp("("+s.re.schema_test.source+")|("+s.re.host_fuzzy_test.source+")|@","i"),Cs(s)}function Ns(s,e){const n=s.__index__,r=s.__last_index__,o=s.__text_cache__.slice(n,r);this.schema=s.__schema__.toLowerCase(),this.index=n+e,this.lastIndex=r+e,this.raw=o,this.text=o,this.url=o}function Oe(s,e){const n=new Ns(s,e);return s.__compiled__[n.schema].normalize(n,s),n}function M(s,e){if(!(this instanceof M))return new M(s,e);e||vs(s)&&(e=s,s={}),this.__opts__=Ue({},jt,e),this.__index__=-1,this.__last_index__=-1,this.__schema__="",this.__text_cache__="",this.__schemas__=Ue({},Ss,s),this.__compiled__={},this.__tlds__=zs,this.__tlds_replaced__=!1,this.re={},be(this)}M.prototype.add=function(e,n){return this.__schemas__[e]=n,be(this),this};M.prototype.set=function(e){return this.__opts__=Ue(this.__opts__,e),this};M.prototype.test=function(e){if(this.__text_cache__=e,this.__index__=-1,!e.length)return!1;let n,r,o,l,u,i,c,d,h;if(this.re.schema_test.test(e)){for(c=this.re.schema_search,c.lastIndex=0;(n=c.exec(e))!==null;)if(l=this.testSchemaAt(e,n[2],c.lastIndex),l){this.__schema__=n[2],this.__index__=n.index+n[1].length,this.__last_index__=n.index+n[0].length+l;break}}return this.__opts__.fuzzyLink&&this.__compiled__["http:"]&&(d=e.search(this.re.host_fuzzy_test),d>=0&&(this.__index__<0||d<this.__index__)&&(r=e.match(this.__opts__.fuzzyIP?this.re.link_fuzzy:this.re.link_no_ip_fuzzy))!==null&&(u=r.index+r[1].length,(this.__index__<0||u<this.__index__)&&(this.__schema__="",this.__index__=u,this.__last_index__=r.index+r[0].length))),this.__opts__.fuzzyEmail&&this.__compiled__["mailto:"]&&(h=e.indexOf("@"),h>=0&&(o=e.match(this.re.email_fuzzy))!==null&&(u=o.index+o[1].length,i=o.index+o[0].length,(this.__index__<0||u<this.__index__||u===this.__index__&&i>this.__last_index__)&&(this.__schema__="mailto:",this.__index__=u,this.__last_index__=i))),this.__index__>=0};M.prototype.pretest=function(e){return this.re.pretest.test(e)};M.prototype.testSchemaAt=function(e,n,r){return this.__compiled__[n.toLowerCase()]?this.__compiled__[n.toLowerCase()].validate(e,r,this):0};M.prototype.match=function(e){const n=[];let r=0;this.__index__>=0&&this.__text_cache__===e&&(n.push(Oe(this,r)),r=this.__last_index__);let o=r?e.slice(r):e;for(;this.test(o);)n.push(Oe(this,r)),o=o.slice(this.__last_index__),r+=this.__last_index__;return n.length?n:null};M.prototype.matchAtStart=function(e){if(this.__text_cache__=e,this.__index__=-1,!e.length)return null;const n=this.re.schema_at_start.exec(e);if(!n)return null;const r=this.testSchemaAt(e,n[2],n[0].length);return r?(this.__schema__=n[2],this.__index__=n.index+n[1].length,this.__last_index__=n.index+n[0].length+r,Oe(this,0)):null};M.prototype.tlds=function(e,n){return e=Array.isArray(e)?e:[e],n?(this.__tlds__=this.__tlds__.concat(e).sort().filter(function(r,o,l){return r!==l[o-1]}).reverse(),be(this),this):(this.__tlds__=e.slice(),this.__tlds_replaced__=!0,be(this),this)};M.prototype.normalize=function(e){e.schema||(e.url="http://"+e.url),e.schema==="mailto:"&&!/^mailto:/i.test(e.url)&&(e.url="mailto:"+e.url)};M.prototype.onCompile=function(){};const ks=X.memo(({message:s,messages:e,deleteMessage:n,setMessage:r,setImageObject:o,setEditMessageObject:l,setViewingImage:u,setReplyMessage:i,chatId:c,messagesRef:d,messageIndex:h,viewingOldMessages:x,setSeenUsers:y,setMessageOption:g,setReactedUsers:D,index:$,lastFourMessages:F})=>{var ae;const{userData:b,userId:C}=a.useContext(z),B=ee(),{mode:Y}=B.palette,w=C===s.senderId,te=(s==null?void 0:s.seenBy)&&s.seenBy.length>0,q=a.useRef(!1),[v,_]=a.useState(!1),[p,A]=a.useState(!1),[I,J]=a.useState(!1),L=Q=>{_(Q)},de={...s,index:h},me=w?{text:"Edit",icon:t.jsx(pt,{}),onClick:()=>{l(de),r(s.content),o(s==null?void 0:s.image),i(s==null?void 0:s.reply)}}:null,se=w||b!=null&&b.isAdmin?{text:"Delete",icon:t.jsx(xt,{}),onClick:()=>{n(s,h)}}:null;return a.useEffect(()=>{const Q=()=>{let U=!1;F.forEach(ne=>{ne.id===s.id&&(U=!0)}),A(U)};(()=>{let U=!1;((s==null?void 0:s.seenBy)||[]).forEach(ve=>{C===ve.uid&&(U=!0)}),J(U)})(),Q()},[]),a.useEffect(()=>{s&&(async()=>{const Z=E(d,s.id);if(!q.current&&!I&&!w&&p&&!x)try{await oe(Z,{seenBy:Te({uid:C,timestamp:new Date().getTime()})}),q.current=!0}catch(U){console.error("Error marking message as seen: ",U)}})()},[p,I]),t.jsxs(R,{onMouseEnter:()=>L(!0),onMouseLeave:()=>L(!1),className:`${Y==="dark"?"hover:bg-slate-700 border-slate-700/50":"hover:bg-slate-100 border-slate-200"}  rounded-md flex mb-1 gap-x-2 pt-2 pb-2   ${w?"flex-row-reverse":""} `,children:[t.jsx($s,{senderId:s.senderId}),t.jsx("div",{className:"grid gap-y-1 whitespace-pre-wrap ",children:t.jsxs("div",{className:`flex  items-start gap-x-1 ${w?"flex-row-reverse justify-start":""}`,children:[t.jsx("div",{className:"relative",children:t.jsxs("div",{className:`min-w-[200px] max-w-[300px]  shadow-md border border-slate-300 ${w?"justify-start":"fdbg-white  "} grid min-w-20 break-words whitespace-pre-wrap text-wrap rounded-[10px] border-slate-200 p-3 pb-0 `,children:[t.jsx(Ms,{senderId:s.senderId,isYourMessage:w}),(s==null?void 0:s.reply)&&t.jsx(Bs,{message:s,setViewingImage:u}),t.jsx(yt,{content:s.content,isYourMessage:w}),(s==null?void 0:s.image)&&t.jsx("img",{onClick:()=>{u(s.image)},className:"cursor-pointer mt-1 mb-1 rounded-md max-h-[200px] overflow-hidden  ",alt:s.image.name,src:s.image.URL}),t.jsx(ps,{chatId:c,message:s,setReactedUsers:D}),t.jsx("div",{className:`flex  ${w?"flex-row-reverse":""} gap-x-1 items-center mt-1`,children:t.jsxs("p",{className:`  mt-1 p-1 text-sm text-gray-400 text-sm flex gap-x-1 items-center ${w?"text-right":""}`,children:[s!=null&&s.editedTime?t.jsxs("span",{children:["edited ",Le(De(s.editedTime))]}):t.jsx("span",{children:Le(De(s.timestamp))}),te?t.jsx(k,{title:s.seenBy.length==1?"Seen by 1 user":"Seen by "+s.seenBy.length+" users",arrow:!0,children:t.jsx(xe,{size:"small",startIcon:t.jsx(Xt,{}),onClick:()=>{y(s.seenBy)},className:"flex gap-x-1 items-center",children:(ae=s==null?void 0:s.seenBy)==null?void 0:ae.length})}):""]})})]})}),v&&t.jsx(k,{title:"More options",arrow:!0,children:t.jsx(W,{onClick:()=>g({...s,options:[me,se,{text:"Reply",icon:t.jsx(cs,{}),onClick:()=>i(s)}]}),children:t.jsx(es,{})})})]})})]})}),yt=({content:s,isYourMessage:e=!1})=>{const n=new M;n.tlds("onion",!0),n.set({fuzzyLink:!0});const r=n.match(s),o=(l,u=30)=>l.length>u?l.slice(0,u)+"...":l;return r&&r.forEach(l=>{const u=l.url.startsWith("http")?l.url:`https://${l.url}`;s=s.replace(l.url,`<a href="${u}" style="text-decoration: underline; color: blue;" target="_blank" rel="noopener norefereer">${o(u)}<a>`)}),t.jsx("div",{className:"w-full max-w-full break-words  ",dangerouslySetInnerHTML:{__html:s}})},$s=({senderId:s})=>{const{users:e}=a.useContext(z),[n,r]=a.useState(null),[o,l]=a.useState(!0);G(s,e,r,l);const[u,i]=a.useState("offline"),[c,d]=a.useState(null),h=ce();return Ze(s,i,d),o?t.jsx(H,{variant:"circular",height:40,width:40}):t.jsxs("div",{className:"size-10  relative",children:[t.jsx(k,{placement:"top",arrow:!0,title:`View ${n==null?void 0:n.name}'s profile
        `,children:t.jsx("div",{className:"cursor-pointer",onClick:()=>h(`/app/profile/${n==null?void 0:n.uid}`),children:t.jsx(re,{name:n&&n.name,image:n&&n.image})})}),t.jsx("div",{className:"size-[16px] bg-white rounded-full flex justify-center items-center absolute bottom-0 right-0",children:t.jsx("div",{className:` size-3 rounded-full ${u==="online"?"bg-green-500":"bg-gray-500"}`})})]})},Ms=({senderId:s,isYourMessage:e})=>{const{users:n}=a.useContext(z),[r,o]=a.useState(null),[l,u]=a.useState(!0),i=ce();return G(s,n,o,u),l?t.jsx("div",{className:`-mt-3 ${e?"text-right":""}`,children:t.jsx(H,{height:40,width:120})}):t.jsx(k,{placement:"top",arrow:!0,title:`View ${r==null?void 0:r.name}'s profile`,children:t.jsx("p",{onClick:()=>i(`/app/profile/${r==null?void 0:r.uid}`),className:`cursor-pointer font-bold mb-2 ${e?"text-right":""} `,children:r!=null&&r.name?r.name:"Unknown User"})})},Bs=({message:s,setViewingImage:e})=>{const{users:n}=a.useContext(z),{senderId:r,content:o,image:l}=s.reply,[u,i]=a.useState(!0),[c,d]=a.useState(!1),[h,x]=a.useState(null);return G(r,n,x,i),t.jsxs("div",{className:"mb-1 border-l-4 p-1 rounded-md border-l-green-500 ",children:[u?t.jsx(H,{width:120,height:40}):t.jsx("p",{className:"font-bold ",children:h==null?void 0:h.name}),o&&t.jsxs("p",{className:"w-full max-w-full break-words",children:[t.jsx(yt,{content:c?o:He(o,25)}),o.length>=25&&t.jsx("span",{onClick:()=>{d(!c)},className:"font-bold text-blue-400 cursor-pointer",children:c?" see less":" see more"})]}),l&&t.jsx("img",{onClick:()=>{e(l)},className:"cursor-pointer border mt-1 mb-1 rounded-md border-slate-200 overflow-hidden max-h-[200px]",alt:l.name,src:l.URL})]})},Rs=({setIsRulesOpen:s,isRulesOpen:e,rules:n=["ရိုသေလေးစားမှုရှိပါ - Group ထဲတွင် ရှိသောသူများအားလုံးကို လေးစားရမည်။ မသင့်တော်သော စကားလုံးများ၊ အခြားသူများကို ထိခိုက်စေနိုင်သော စကားလုံးများကို မပြောရ။","No spamming - တူညီသော မက်ဆေ့ချ်များ၊ လင့်ခ် (link) များနှင့်၊ အမြောက်အများသော emoji များ ပို့ခြင်းကို မပြုရ။","Privacy ရှိပါ - တစ်စုံတစ်ဦး၏ ကိုယ်ရေးကိုယ်တာ အချက်အလက်များကို ခွင့်ပြုချက်မရှိဘဲ မမျှဝေရ။ လူတိုင်း၏ ကိုယ်ရေးကိုယ်တာကို လေးစားပါ။","အထက်ပါ စည်းမျဉ်းစည်းကမ်းများ (rules) ထဲမှ တစ်ခုခုကို ချိုးဖောက်ပါက Group ထဲမှ ရက်အကန့်အသတ်ဖြင့် သော်လည်းကောင်း၊ ရာသတ်ပန် သော်လည်းကောင်း ထုတ်ပယ်မည် (သို့မဟုတ်) ထိုက်တန်သော အပြစ်တစ်ခုခုကို ခံယူရမည်။"]})=>t.jsx(We,{open:e,onClose:()=>s(!1),children:n?t.jsxs("div",{className:"p-2 max-h-[80%] overflow-auto",children:[t.jsx("p",{className:"font-bold mb-1",children:"Group Rules"}),n.map((r,o)=>t.jsxs("div",{className:"flex items-start  gap-x-1 mb-2",children:[t.jsx("p",{className:"size-10 items-center flex justify-center rounded-full ",children:o+1}),t.jsx("p",{className:"flex-1 text-sm",children:r})]},`${o}-${r}`))]}):t.jsx("div",{className:"p-2",children:"No rules"})}),Is=({typingUsersRef:s,viewingOldMessages:e})=>{const{userId:n,openSnackbar:r}=a.useContext(z),[o,l]=a.useState([]),[u,i]=a.useState(!1),c=()=>{const d=window.scrollY,h=window.innerHeight,x=document.documentElement.scrollHeight;i(d+h>=x-350)};if(a.useEffect(()=>{const h=le(s,y=>{console.log("fetching typing users...");const g=y.docs.map(D=>({uid:D.id,...D.data()}));l(g)},y=>{console.log("Error fetching typing users: ",y.message)});return()=>{h&&h()}},[]),a.useEffect(()=>{!e&&o.length!==0&&u&&ie()},[o,u]),a.useEffect(()=>(window.addEventListener("scroll",c),()=>{window.removeEventListener("scroll",c)}),[]),o.length>0)return t.jsx("div",{className:"",children:t.jsx("div",{className:"grid gap-y-1",children:o.sort((d,h)=>ue(d,h,"timestamp","older")).map(d=>{const h=n===d.uid;return t.jsxs("div",{className:`flex mb-2 gap-x-2 ${h?"flex-row-reverse":""} `,children:[t.jsx(Ts,{typingUser:d}),t.jsxs("div",{className:"grid gap-y-1 whitespace-pre-wrap",children:[t.jsx(Ls,{isYourMessage:h,typingUser:d}),t.jsx("div",{className:`flex items-start gap-x-1 ${h?"flex-row-reverse justify-start":""}`,children:t.jsxs("div",{children:[t.jsx(H,{height:40,width:150}),t.jsx(H,{sx:{mt:-1},height:30,width:100})]})})]})]},`typingUsers-${d.uid}`)})})})},Ts=({typingUser:s})=>{const{users:e}=a.useContext(z),[n,r]=a.useState(null),[o,l]=a.useState(!0);return G(s.uid,e,r,l),t.jsxs("div",{className:"size-10 relative",children:[o?t.jsx(H,{width:40,height:40}):t.jsx(re,{name:n==null?void 0:n.name,image:n==null?void 0:n.image}),t.jsx("div",{className:"absolute bottom-0 right-0 size-3 rounded-full bg-green-500"})]})},Ls=({typingUser:s,isYourMessage:e})=>{const{users:n}=a.useContext(z),[r,o]=a.useState(null),[l,u]=a.useState(!0);return G(s.uid,n,o,u),t.jsx(t.Fragment,{children:l?t.jsx(H,{height:40,width:120}):t.jsx("p",{className:`font-bold ${e?"text-right":"text-left"} `,children:r==null?void 0:r.name})})},Us=["January","February","March","April","May","June","July","August","September","October","November","December"],Os=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function Dt(s){const e=new Date(s),n=new Date,r=e.getFullYear(),o=e.getMonth(),l=e.getDate(),u=Os[e.getDay()],i=n.getDay()===e.getDay()&&n.getMonth()===e.getMonth()&&n.getFullYear()===e.getFullYear(),c=!i&&e.getDay()===n.getDay()-1;return i?"Today":c?"Yesterday":`${u}, ${Us[o]} ${l}, ${r}`}const Zs=({seenUsers:s,setSeenUsers:e})=>{a.useContext(z);const n=ee(),{mode:r}=n.palette,o=()=>{const l=s.reduce((u,i)=>{const c=new Date(De(i.timestamp)),d=c.getFullYear(),h=c.getMonth(),x=c.getDate(),y=`${d}-${h+1}-${x}`;return u[y]||(u[y]={date:y,users:[]}),u[y].users.push(i),u},{});return Object.values(l)};return t.jsx(We,{fullWidth:!0,anchor:"bottom",open:!!s,onClose:()=>e(!1),children:t.jsxs(R,{className:" rounded-l-md rounded-r-md ",children:[t.jsx(T,{sx:{p:1},variant:"h6",children:"People who have seen"}),t.jsx("div",{className:"flex flex-col p-2",children:o().map(l=>{const u=new Date(l.date).getTime(),i=Dt(u);return t.jsxs(R,{children:[t.jsx(T,{variant:"caption",children:i}),l.users.sort((c,d)=>ue(c,d,"timestamp","older")).map((c,d)=>t.jsx(Ps,{seenPerson:c,mode:r},`seenUser-${c.uid}-${d}`))]},i+"seenUsers")})})]})})},Ps=({seenPerson:s,mode:e})=>{var i;const{users:n}=a.useContext(z),[r,o]=a.useState(null),[l,u]=a.useState(!0);return G(s.uid,n,o,u),l?t.jsx("div",{className:"mb-1 w-[275px]",children:t.jsx(Ve,{})}):t.jsxs("div",{className:`${e==="light"?"hover:bg-slate-200":"hover:bg-slate-700"} flex p-2 justify-between items-center w-full rounded-md `,children:[t.jsxs("div",{className:"flex items-center gap-x-1",children:[t.jsx(re,{image:r==null?void 0:r.image,name:r==null?void 0:r.name,size:"size-9"}),t.jsx("p",{children:((i=r==null?void 0:r.name)==null?void 0:i.length)>20?He(r==null?void 0:r.name,20):r==null?void 0:r.name})]}),t.jsx(T,{variant:"caption",children:Le(s.timestamp)})]})},Vs=({reactedBy:s,removeReaction:e,reactedUsers:n,setReactedUsers:r})=>{const{userId:o}=a.useContext(z),l=ee(),{mode:u}=l.palette,i=c=>({like:"facebookLike",love:"facebookLove",haha:"facebookHaha",wow:"facebookWow",sad:"facebookSad",angry:"facebookAngry"})[c];return t.jsx(We,{fullWidth:!0,open:!!s,onClose:()=>r(null),children:t.jsxs("div",{className:"m-2  rounded-l-md rounded-r-md ",children:[t.jsx(T,{variant:"h6",children:"Reactions"}),t.jsx("div",{className:"flex flex-col p-2  overflow-y-auto",children:s.map((c,d)=>{const h=c.uid===o;return t.jsx(Hs,{mode:u,okToRemove:h,reactedPerson:c,getReactIcon:i,removeReaction:e,close:()=>r(null)},`reactedBy-${c.uid}-${d}`)})})]})})},Hs=({getReactIcon:s,reactedPerson:e,okToRemove:n,close:r,removeReaction:o,mode:l})=>{const{users:u}=a.useContext(z),[i,c]=a.useState(null),[d,h]=a.useState(!0);return G(e.uid,u,c,h),d?t.jsx(Ve,{}):t.jsxs("div",{onClick:()=>{n&&(o(),r())},className:`flex p-2 justify-between items-center ${l==="light"?"hover:bg-slate-100":"hover:bg-slate-700"} ${n?"cursor-pointer":""}`,children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(re,{image:i==null?void 0:i.image,name:i==null?void 0:i.name,size:"size-9"}),t.jsxs("p",{className:"ml-[4px]",children:[i==null?void 0:i.name," ",n?t.jsx(T,{variant:"caption",children:"(Tap to remove)"}):""]})]}),t.jsx("img",{className:"w-6 ",src:Ge(s(e.reactionType))})]})},Be=15,Cn=X.memo(()=>{const{userId:s,users:e}=a.useContext(z),{chatId:n}=lt(),[r,o]=a.useState(null),[l,u]=a.useState(!1),i=E(V,"chats",n),[c,d]=a.useState(!0),[h,x]=a.useState(!1),[y,g]=a.useState(null);return a.useEffect(()=>{const D=()=>le(i,C=>{d(!0),C.exists()?(o({...C.data(),id:C.id}),x(!1)):x(!0),d(!1)},C=>{const B="Error fetching the current chat: "+C.message;console.log(B),g(B),d(!1)});(async()=>{try{const b=O(i,"members"),C=je(b,mt("uid","==",s),ye(1));console.log("Checking if a member...");const B=await Pe(C);u(!B.empty)}catch(b){console.log(b.message)}})();const F=D();return()=>{F&&F()}},[n,l]),c?t.jsx(ns,{isLoading:c,text:"Loading chat..."}):h?t.jsx(Me,{text:"No chat available"}):l?y?t.jsx(Me,{text:y}):t.jsx(Gs,{chatId:n,currentChat:r}):t.jsx(Me,{text:"You are not a member of this chat room"})}),Gs=({chatId:s,currentChat:e})=>{const{userData:n,users:r,newMessages:o,userId:l,setHeaderTitle:u,openSnackbar:i}=a.useContext(z),[c,d]=a.useState(""),[h,x]=a.useState("chat"),[y,g]=a.useState(null),D=E(V,"chats",s),$=O(D,"messages"),[F,b]=a.useState(null),[C,B]=a.useState(!1),[Y,w]=a.useState(!1),[te,q]=a.useState(null),[v,_]=a.useState(null),[p,A]=a.useState(null),[I,J]=a.useState(!1),L=O(D,"typingUsers"),de=E(L,l),[me,se]=a.useState(!1),[ae,Q]=a.useState(null),[Z,U]=a.useState([]),[ne,ve]=a.useState([]),[Se,bt]=a.useState([]),[qs,wt]=a.useState(),[Ye,Ft]=a.useState(null),[K,Ee]=a.useState(!1),[vt,St]=a.useState([]),[qe,Je]=a.useState(null),[he,ze]=a.useState(null),[_e,Qe]=a.useState(null);a.useState(!1);const[Ke,Et]=a.useState(0),[zt,Xe]=a.useState(!0),Ct=ee(),{mode:Ce}=Ct.palette;a.useEffect(()=>{const f=(()=>{const j=Lt(Yt,"/status"),S=Ut(j,Zt("status"),Ot("online"));return Pt(S,P=>{Et(P.size)})})();return()=>{f&&f()}},[]),a.useEffect(()=>{(async()=>{const f=E(V,"chats",e.id),j=O(f,"members");await ht(j,Je)})()},[e]),a.useEffect(()=>{u((e==null?void 0:e.name)||"SEA - Chat ")},[]),a.useEffect(()=>{let m;return c.trim()?se(!0):se(!1),m=setTimeout(()=>{se(!1)},3e3),()=>{clearTimeout(m)}},[c]);const At=async()=>{console.log("I am typing...");try{await Re(de,{timestamp:fe()})}catch(m){console.error("Error adding user to typing collection: ",m)}},et=async()=>{console.log("I am not typing...");try{await ge(de)}catch(m){console.error("Error removing user from typing collection: ",m)}};a.useEffect(()=>(me?At():et(),()=>{et()}),[me]);const tt=m=>{m.docs.length>0&&(wt(m.docs[0]),Ft(m.docs[m.docs.length-1]));const f=m.docs.map(S=>({id:S.id,...S.data()}));f.length<Be&&K&&(Xe(!1),Ee(!1),Ae(),ie());const j=f.sort((S,N)=>ue(S,N,"timestamp"));U(j),ve(j.slice(f.length-5,f.length))};a.useEffect(()=>{console.log(ne)},[ne]);const Ae=()=>{if(K)return null;Xe(!0);const m=O(E(V,"chats",s),"messages");let f=je(m,rt("timestamp","desc"),ye(Be));const j=le(f,S=>{console.log("Fetching messages..."),tt(S)});return()=>j()};a.useEffect(()=>{const m=Ae();return()=>{m&&m()}},[s,K]);const st=async m=>{const f=m==="old"?"desc":"asc";if(!Ye)return;const j=je($,rt("timestamp",f),Vt(Ye),ye(Be));console.log("Fetching messages...");const S=await Pe(j);tt(S)};G(v==null?void 0:v.senderId,r,A,()=>{},[v]);const Nt=async m=>{const f=new Date().getTime(),j=`chats/${s}/${f}-${n==null?void 0:n.name}-${m==null?void 0:m.name}`,S=Ie(at,j);B(!0),w(!0);try{const N=await _t(m,{maxSizeMB:.5,maxWidthOrHeight:1280,useWebWorker:!0}),P=await ut(S,N),ke=await dt(P.ref),$e={name:m.name,path:j,URL:ke,size:N.size};b($e),B(!1),w(!1)}catch(N){i(N.message),B(!1),w(!1),console.log(N.message)}},kt=async m=>{const f=Ie(at,m);await Ht(f),b(null)},nt=async()=>{const m=E(O(V,"newMessages"),s);await Re(m,{seenBy:Te(l)})};a.useEffect(()=>{(async()=>{const f=E(O(V,"newMessages"),s);Gt(o,s)||await oe(f,{seenBy:Te(l)})})()},[Z]);const $t=async()=>{try{const m={senderId:l,content:c.trim(),timestamp:fe(),image:F||null,reply:v||null,seenBy:[]};w(!0),await Wt($,m),nt(),d(""),b(null),ie(),w(!1),_(null),A(null),se(!1)}catch(m){w(!1),i(m.message),console.log(m.message)}},Ne=async()=>{try{const m=E($,y.id),f={senderId:l,content:c.trim(),editedTime:fe(),image:F||null,reply:v||null};w(!0),await oe(m,f),nt(),Ne&&d(""),b(null),g(null),w(!1),_(null),A(null)}catch(m){w(!1),i(m.message),console.log(m.message)}},Mt=m=>{const f=Z.filter(j=>j.id!==m);U(f)},Bt=async(m,f)=>{const j=E($,m.id);K&&Mt(m.id),await ge(j)};return a.useEffect(()=>{bt((()=>{if(Z.length>0){const f=Z.reduce((j,S)=>{const N=new Date(De(S.timestamp)),P=N.getFullYear(),ke=N.getMonth(),$e=N.getDate(),pe=`${P}-${ke+1}-${$e}`;return j[pe]||(j[pe]={date:pe,messages:[]}),j[pe].messages.push(S),j},{});return Object.values(f)}else return})())},[Z]),h==="info"?t.jsx(ms,{setSubPage:x,currentChat:e,memberCounts:qe,setMemberCounts:Je,members:vt,setMembers:St,onlineUsers:Ke}):t.jsxs(R,{color:"text.primary",className:"",children:[t.jsx(Ys,{}),_e&&t.jsx(Vs,{reactedBy:_e.reactedBy,removeReaction:_e.removeReaction,reactedUsers:_e,setReactedUsers:Qe}),he&&t.jsx(ts,{handleClick:()=>{ze(null)},messageOption:he,setMessageOption:ze,options:he.options,message:he,chatId:s,isComment:!1}),te&&t.jsx(ss,{image:te,setViewingImage:q}),I&&t.jsx(Rs,{isRulesOpen:I,setIsRulesOpen:J,rules:e==null?void 0:e.rules}),ae&&t.jsx(Zs,{seenUsers:ae,setSeenUsers:Q}),t.jsx(gt,{pageName:"info",setSubPage:x,currentChat:e,memberCounts:qe,onlineUsers:Ke}),t.jsxs("div",{id:"message-container",className:"p-2 gap-y-3 mb-[55px]",children:[t.jsx("div",{className:"flex justify-center mb-2",children:t.jsx(xe,{sx:{textTransform:"capitalize",mt:1},variant:"text",size:"small",onClick:async()=>{await st("old"),ie(),Ee(!0)},children:"Older messages"})}),t.jsx(R,{children:Se==null?void 0:Se.map((m,f)=>{const j=new Date(m.date).getTime(),S=Dt(j);return t.jsxs(R,{children:[t.jsx(R,{className:"z-10 sticky top-[70px] flex justify-center",children:t.jsx(T,{sx:{p:"3px",borderRadius:1},bgcolor:"background.default",variant:"caption",children:S})}),m.messages.map((N,P)=>t.jsx(ks,{editMessage:Ne,setEditMessageObject:g,deleteMessage:Bt,message:N,setMessage:d,setImageObject:b,setViewingImage:q,setReplyMessage:_,chatId:s,messagesRef:$,groupIndex:f,messageIndex:P,viewingOldMessages:K,setSeenUsers:Q,messages:Z,setMessageOption:ze,setReactedUsers:Qe,lastFourMessages:ne,index:P},`${P}-${N.id}`))]},m.date)})}),K&&zt?t.jsxs("div",{className:"flex gap-x-1 justify-center mt-1 mb-2",children:[t.jsx(xe,{size:"small",sx:{textTransform:"capitalize"},onClick:async()=>{await st("new"),Rt()},children:"Newer messages"}),t.jsx(k,{placement:"top",title:"Latest messages",arrow:!0,children:t.jsx(rs,{onClick:()=>{Ee(!1),ie(),Ae()},size:"small",sx:{position:"fixed",bottom:150,right:20},children:t.jsx(os,{})})})]}):"",t.jsx(Is,{typingUsersRef:L,viewingOldMessages:K})]}),t.jsxs(R,{bgcolor:"background.default",className:`fixed ${Ce==="light"?"border-t-slate-100":"border-t-slate-700"} z-30 bottom-0 border-t  shadow-t-md right-0 left-0 p-2 min-h-[80px] flex flex-col items-center`,children:[t.jsx("div",{className:"w-full flex justify-between items-center text-sm p-1 pt-0 md:w-2/3 lg:w-1/2",children:t.jsx(xe,{size:"small",sx:{textDecoration:"underline"},onClick:()=>J(!0),className:"text-sm underline text-blue-300",children:"Group Rules"})}),y&&t.jsxs("div",{className:"w-full flex justify-between items-center text-sm p-1 md:w-2/3 lg:w-1/2",children:[t.jsx("p",{children:"Editing a message"}),t.jsx(W,{onClick:()=>{g(null),d(""),b(null),_(null),A(null)},children:t.jsx(it,{})})]}),v&&t.jsxs("div",{className:"w-full flex justify-between items-center text-sm p-1 md:w-2/3 lg:w-1/2",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("p",{className:"font-bold",children:["Reply to ",p==null?void 0:p.name]}),t.jsx("p",{children:He(v==null?void 0:v.content,25)})]}),t.jsx(W,{onClick:()=>{_(null),A(null)},children:t.jsx(it,{})})]}),C&&t.jsx("div",{className:"w-full flex justify-between items-center text-sm p-1 md:w-2/3 lg:w-1/2",children:t.jsx("p",{children:"Uploading image..."})}),F&&t.jsxs("div",{className:"w-full flex justify-between items-center text-sm p-1 md:w-2/3 lg:w-1/2",children:[t.jsxs("div",{className:"flex flex-1 items-center gap-x-1",children:[t.jsx("img",{src:F.URL,className:"h-10 rounded-sm"}),t.jsx("p",{children:F.name})]}),t.jsx("button",{onClick:()=>{kt(F.path),b(null)},className:"rounded-full shadow-sm p-1",children:t.jsx("img",{className:"w-6",src:Ge("falseIcon")})})]}),t.jsxs(R,{className:`border ${Ce==="light"?"border-t-slate-100":"border-slate-700"} shadow-sm w-full md:w-2/3 lg:w-1/2 p-1 rounded-[12px] flex items-center justify-between `,children:[t.jsx("input",{id:"imageFile",className:"hidden",type:"file",onChange:m=>{Nt(m.target.files[0])},accept:"image/*"}),t.jsx(k,{arrow:!0,title:"Upload an image",placement:"top",children:t.jsx("label",{htmlFor:"imageFile",className:"p-1 cursor-pointer rounded-md",children:t.jsx(as,{sx:{width:28}})})}),t.jsx(Ws,{value:c,setValue:d}),t.jsx(k,{title:"Send",arrow:!0,placement:"top",children:t.jsx(W,{disabled:Y,sx:{color:Ce==="light"&&"black"},onClick:()=>{!Y&&(c.trim()||F)&&(y?Ne():$t())},children:t.jsx(ls,{})})})]})]})]})},Ws=X.memo(({value:s,setValue:e})=>t.jsx(ft,{multiline:!0,maxRows:4,fullWidth:!0,sx:{"& .MuiOutlinedInput-root":{"& fieldset":{border:"none"}}},inputProps:{sx:{padding:"5px"},inputMode:"text",autoCorrect:"off",autoCapitalize:"off"},value:s,onChange:n=>e(n.target.value),placeholder:"Type a message..."})),Ys=()=>{It("chat-page"),Tt("chat-page")};export{Cn as default};
