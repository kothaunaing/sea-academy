import{j as e,r as i,A as I,u as M,F as E,d as z,b as F,c as X,aE as J,e as R,a as K,s as k,f as C,aX as U,aY as W}from"./index-bRWVs4uH.js";import{C as Z}from"./ConfirmDelete-NqjvmjUg.js";import{T as _}from"./Tooltip-nMSGeA9R.js";import{I as ee}from"./IconButton-G7F5S18q.js";import{A as B}from"./ArrowBackSharp-YQSLNk1z.js";import{g as te}from"./getImage-SzyEh5nT.js";import{n as se}from"./notify-SVbv2jGG.js";import{c as H}from"./createSvgIcon-WuW5eNVd.js";import{L as ne}from"./LoadingScreen-s9LTCXQM.js";import{M as D}from"./EmptyComponent-B0v7Kud4.js";import"./Dialog-uv1MMool.js";import"./Modal-AoQCLYuG.js";import"./Portal-VKXgkAI7.js";import"./Stack-oEJLfJtD.js";import"./useControlled-W8367X1y.js";const re=H(e.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForwardSharp"),oe=H(e.jsx("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"}),"DoneSharp"),ae=({data:r})=>{const{pageTitle:t,currentPage:o,totalPage:s,percentage:n,answerLength:c,questionsLength:a}=r,{stopTest:m,formattedTime:l}=i.useContext(I),d=M(),[p,f]=i.useState(!1),v=()=>{m(),f(!1),d("/app/tests")},h=()=>{f(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:" font-medium text-lg flex items-center justify-start",children:[e.jsx(_,{title:"Navigate up",arrow:!0,children:e.jsx(ee,{onClick:()=>f(!0),children:e.jsx(B,{})})}),e.jsx("div",{className:"ml-2 ",children:t}),e.jsx(Z,{data:{value:p,yesButton:v,noButton:h,text:"Are you sure to stop the test ?",setValue:f}})]}),e.jsxs("div",{className:"flex justify-between items-center sticky left-0 pt-1 right-0 z-10 ",children:[e.jsxs("div",{children:["Page ",o," of ",s]}),e.jsxs("div",{className:"w-2/3 border h-7 relative",children:[e.jsx("div",{style:{width:`${n}%`},className:"text-center h-full"}),e.jsxs("div",{className:"absolute top-0 left-2 font-medium",children:[c," ","/"," ",a]})]}),e.jsx("div",{className:"min-h-12 font-medium fixed right-0 top-1/4 h-10 min-w-20 bg-lime-200/50 backdrop-blur-lg flex items-center justify-center rounded-bl-lg rounded-tl-lg border-r-4 border-r-blue-400",children:l})]})]})},ie=({data:r})=>{const{currentQuestions:t,chooseAnswer:o,answeredQuestions:s}=r;return e.jsx("div",{children:t==null?void 0:t.map((n,c)=>e.jsxs("div",{children:[e.jsxs("div",{className:"grid gap-y-2",children:[e.jsxs("div",{className:"flex gap-x-3 items-center",children:[e.jsx("div",{className:"bg-blue-600 rounded-sm shadow-lg h-9 w-9 text-white font-bold flex justify-center items-center ",children:n.id}),e.jsx("div",{className:"flex-1 font-padauk",children:n.question})]}),e.jsx("div",{className:"grid gap-y-2",children:n.choices.map((a,m)=>{let l,d=!1;return s.forEach(p=>{n.id===p.id&&(l=p)}),(l==null?void 0:l.userAnswer)===a&&(d=!0),e.jsxs("div",{onClick:()=>{o(n.id,a)},className:"border  h-12 flex gap-x-3 p-2 cursor-pointer items-center rounded-lg font-padauk",children:[e.jsx("input",{onChange:()=>{o(n.id,a)},className:"h-5 w-5",name:`question-${n.id}`,type:"radio",checked:!!d}),e.jsx("div",{children:a})]},`choice-${n.id}-${m}-${a}`)})})]}),e.jsx(ce,{})]},`question-${n.id}-${c}-${n.question}`))})},ce=()=>e.jsx("div",{className:" border border-dashed border-gray-500 mb-7 mt-7"}),le=()=>e.jsxs("div",{className:"flex gap-x-2 items-center",children:[e.jsx("img",{className:"w-8 ",src:te("error")}),e.jsx("div",{className:"text-red-600 font-bold",children:"You need to answer all questions before proceeding!"})]});function de(r,t,o){const s=t.name,n=ue(r,t.quizzes),c=me(n),a=r.length,m=t.gradingRules.length!==0?fe(c,t.gradingRules)||"There is an error in your grading rules":"Level is not defined",l=he(),d=xe();return{testName:s,results:n,score:c,totalScore:a,level:m,date:l,time:d,timeTaken:o}}function ue(r,t){return t.map(s=>{const{id:n,question:c,answer:a}=s;let m;r.forEach(d=>{n===d.id&&(m=d)});const{userAnswer:l}=m;return l===s.answer?{id:n,question:c,userAnswer:l,answer:a,isTrue:!0}:{id:n,question:c,userAnswer:l,answer:a,isTrue:!1}})}function me(r){let t=0;return r.forEach(o=>{o.isTrue&&t++}),t}function fe(r,t){let o;try{t.forEach(s=>{r>=Number(s.from)&&r<=Number(s.to)&&(o=s.level)})}catch(s){console.log(s.message)}return o}function he(){const r=new Date,t=r.getDate(),o=r.getMonth()+1,s=r.getFullYear();return`${t}/${o}/${s}`}function xe(){const r=new Date;let t=r.getHours();const o=r.getMinutes(),s=t>12?"PM":"AM";t=t%12||12;const n=o<10?`0${o}`:o;return`${t}:${n} ${s}`}const ge=({data:r})=>{const{nextPage:t,prevPage:o,isEnded:s,startIndex:n,currentTest:c,answeredQuestions:a,testId:m}=r,{formattedTime:l,stopTest:d,userId:p}=i.useContext(I),f=M(),v=async()=>{try{const x=X(F(z,"users",p),"history"),u=de(a,c,l),y=await J(x,u),b=(await R(y)).id;f(`/app/history/${b}`)}catch(x){console.log(x.message)}},h=async()=>{await v(),d(),se(["took","test"],"testName",c.name,null,m)};return e.jsxs("div",{className:"flex justify-center gap-x-5",children:[n!==0&&e.jsx(E,{variant:"outlined",size:"small",onClick:o,startIcon:e.jsx(B,{}),children:"Previous"}),s?e.jsx(E,{variant:"outlined",size:"small",onClick:h,startIcon:e.jsx(oe,{}),children:"Finish"}):e.jsx(E,{variant:"outlined",size:"small",onClick:t,startIcon:e.jsx(re,{}),children:"Next"})]})},Me=()=>{var L,P;i.useContext(I);const{testId:r}=K(),[t,o]=i.useState([]),[s,n]=i.useState(null),[c,a]=i.useState(!0),[m,l]=i.useState(!1),[d,p]=i.useState(null),[f,v]=i.useState(!1);i.useEffect(()=>{(async()=>{try{a(!0);const j=F(z,"tests",r),N=await R(j);N.exists()?(n(N.data()),C(a,1200)):(C(a),l(!0))}catch(j){C(a,1200),p("Failed to fetch current test: "+j.message)}})()},[]);const h=t==null?void 0:t.length,x=(L=s==null?void 0:s.quizzes)==null?void 0:L.length,[u,y]=i.useState(0),[b,T]=i.useState(!1),[Y,A]=i.useState(!1),g=10;let G=(P=s==null?void 0:s.quizzes)==null?void 0:P.slice(u,u+g);const q=s==null?void 0:s.name,O=Math.ceil(x/g),Q=Math.ceil((u+g)/g),V=Math.round(h/x*100);i.useEffect(()=>(k(),k()),[]),i.useEffect(()=>{h===x&&u+g>=x?T(!0):T(!1)},[u,t]),i.useEffect(()=>{h>=u+g?A(!0):A(!1)},[t,u]);const S={pageTitle:q,currentPage:Q,totalPage:O,percentage:V,answerLength:h,questionsLength:x,answeredQuestions:t,currentQuestions:G,isEnded:b,chooseAnswer:(w,j)=>{const N=W(w,t);o(N?t.map($=>w===$.id?{id:w,userAnswer:j}:$):[...t,{id:w,userAnswer:j}])},nextPage:()=>{Y?(y(u+g),h<=u+g&&k()):U(v)},prevPage:()=>{y(Math.max(u-g,0))},startIndex:u,currentTest:s,testId:r};return c?e.jsx(ne,{isLoading:c,text:"Loading test..."}):m?e.jsx(D,{text:"No test available"}):d?e.jsx(D,{text:f}):e.jsxs("div",{className:"p-3 grid gap-y-3",children:[e.jsx(ae,{data:S}),e.jsx(ie,{data:S}),f&&e.jsx(le,{}),e.jsx(ge,{data:S})]})};export{Me as default};
