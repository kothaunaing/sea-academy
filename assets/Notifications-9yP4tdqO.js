import{j as e,r as t,A as D,h as I,E as g,aL as U,F as z,K as A,u as B,aJ as H,G as R,c as q,d as F,V as M,W as G,aM as J,X as K,Y as P,M as Q,f as V}from"./index-bRWVs4uH.js";import{p as W}from"./prettyDate-uNOGf4QX.js";import{g as X}from"./shortenText-S284lLsL.js";import{L as Y}from"./LoadingScreen-s9LTCXQM.js";import{f as O}from"./fixTime-t8Fgsaat.js";import{M as T}from"./EmptyComponent-B0v7Kud4.js";import{S as C}from"./Skeleton-gudHJ97I.js";const Z=()=>e.jsxs("div",{className:"flex gap-x-2 rounded-md p-2 items-center",children:[e.jsx("div",{children:e.jsx(C,{variant:"circular",width:40,height:40})}),e.jsxs("div",{className:"grid gap-y-2  flex-1 ",children:[e.jsx(C,{variant:"text",width:200}),e.jsx(C,{variant:"rectangular",height:55,width:"90%"})]})]}),ne=()=>{const{setHeaderTitle:o,notiCount:j,setNotiCount:b}=t.useContext(D),f=8,[s,c]=t.useState([]),[d,N]=t.useState(null),[r,i]=t.useState(!0),[k,v]=t.useState(!1),[a,y]=t.useState(null),[h,S]=t.useState(0),[L,l]=t.useState(!0),m=I(),{mode:E}=m.palette,$=async()=>{i(!0);const p=q(F,"notifications");let u=M(p,J("timestamp","desc"),G(f));d&&(u=M(u,K(d)));try{const n=await P(u);if(Q(p,b),n.empty)v(!0);else{const x=n.docs.map(w=>({id:w.id,...w.data()}));c([...s,...x]),N(n.docs[n.docs.length-1]),V(i),S(h+1),x.length<f&&l(!1)}}catch(n){const x="Error fetching notifications: "+n.message;console.log(x),i(!1),y(x)}};return t.useEffect(()=>{$()},[]),t.useEffect(()=>{o("Notifications")},[]),r&&h===0?e.jsx(Y,{isLoading:r,text:"Loading notifications..."}):k?e.jsx(T,{text:"No notifications available"}):a?e.jsx(T,{text:a}):e.jsxs(g,{className:"m-2",children:[e.jsxs(g,{className:`border overflow-hidden shadow-md rounded-md ${E==="dark"?"border-slate-700":"border-slate-200"}`,children:[s.map((p,u)=>e.jsx(_,{mode:E,length:s.length,notification:p,index:u},p.id)),r&&e.jsx(g,{className:"flex justify-center",children:e.jsxs(g,{children:[e.jsx("div",{className:"mb-2",children:"Loading..."}),e.jsx(U,{})]})})]}),L?e.jsx("div",{className:"flex justify-center mt-1 mb-2 ",children:e.jsx(z,{size:"small",onClick:$,children:"load more"})}):""]})},_=A.memo(({notification:o,index:j,length:b,mode:f})=>{let s;const{type:c,description:d,timestamp:N,testName:r,comment:i}=o,k=`${c[0]} ${c[1]}`,{users:v}=t.useContext(D),[a,y]=t.useState(null),[h,S]=t.useState(!0),L=B();switch(H(o.uid,v,y,S),k){case"like post":s="liked a post";break;case"like test":s="liked a test";break;case"comment post":s="commented on a post";break;case"comment test":s="commented on a test";break;case"added post":s="added a post";break;case"added test":s="added a test";break;case"took test":s="took a test";break}return h?e.jsx(Z,{}):e.jsxs("div",{onClick:()=>{if(o!=null&&o.postId){let l,m;c[1]==="post"?(l="sp",m="posts"):(l="st",m="tests"),L(`/app/${m}/${l}/${o.postId}`)}},className:`cursor-pointer flex items-center border-t ${j===0&&"border-t-0"} gap-x-2 p-2 ${j===b-1&&"border-b"} ${f==="dark"?"border-slate-700":"border-slate-200"}`,children:[e.jsx("div",{children:e.jsx("img",{className:"size-10 object-cover rounded-full object-center bg-cover",src:a==null?void 0:a.image})}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("b",{children:a?a==null?void 0:a.name:"Unknown User"})," ",s]}),d&&e.jsx("p",{children:X(d,30)}),r&&e.jsx("p",{children:r}),i&&e.jsx("p",{children:i}),e.jsx(R,{variant:"caption",children:W(O(N))})]})]})});export{ne as default};
