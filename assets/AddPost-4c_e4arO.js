import{j as e,r as n,E as Z,A as G,h as se,c as _,aE as te,d as R,aG as ie,b as W,aF as ne,aC as T,aB as ae,aw as q,ay as B,ax as E,az as J,aA as K,aH as Q}from"./index-14pqm9y1.js";import{g as H}from"./getImage-SzyEh5nT.js";import{p as re}from"./prettyDate-uNOGf4QX.js";import{B as le}from"./BackToAdmin-BXJU8u_3.js";import{M as oe}from"./MoreOption-CBEm1e9N.js";import{D as ce}from"./Dialog-7UnCDBMC.js";import{T as D}from"./TextField-yLRiE9R7.js";import{B as k}from"./Button-dux8T5OH.js";import{c as b}from"./createSvgIcon-BoAk_7pD.js";import{g as de}from"./shortenText-S284lLsL.js";import{s as me}from"./sortByDateNewer-X-Bb2bKS.js";import{f as he}from"./fixTime-t8Fgsaat.js";import{i as xe}from"./browser-image-compression-9kymdGFS.js";import{C as ue}from"./ConfirmDelete-RLdVewKK.js";import{M as X}from"./EmptyComponent-LbBV4xaA.js";import{L as ge}from"./LoadingScreen-EYXdXKre.js";import{E as pe}from"./EditSharp-Qr3GQduu.js";import{D as fe}from"./DeleteSharp-bueuT1qV.js";import{S as Y}from"./Skeleton-aRLWJJ7b.js";import{I as je}from"./IconButton-x0ar69Y7.js";import{A as ve}from"./ArrowBackSharp-LySXSozB.js";import{C as ke}from"./CollectionsSharp-Sop9fVUo.js";import{L as Ne}from"./LinkSharp-V12iGhFD.js";import"./Tooltip-cTALVPIn.js";import"./Portal-YB56xSUH.js";import"./useControlled-qBYEK2eV.js";import"./ButtonBase-ryrwXNwG.js";import"./OtherActions-na3csAt4.js";import"./Typography-F2i8tb5R.js";import"./Modal-XJP-E1k3.js";import"./debounce-gOEKrWSg.js";import"./Stack-bBqHnaWs.js";const O=({data:l})=>{const{clickFn:t,image:r}=l,h=H(r),m=()=>{t&&t()};return e.jsx("button",{onClick:m,className:"shadow-md border  rounded-full p-2 h-10 w-10  font-medium flex  justify-center items-center hover:opacity-70 transition-all",children:e.jsx("img",{src:h})})},be=b(e.jsx("path",{d:"M21.99 6.86 12 1 2 6.86V20h20zM12 13 3.74 7.84 12 3l8.26 4.84z"}),"DraftsSharp"),we=b(e.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm-1 4H8c-1.1 0-1.99.9-1.99 2L6 21c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V11zM8 21V7h6v5h5v9z"}),"FileCopyOutlined"),ye=b(e.jsx("path",{d:"M16 1H2v16h2V3h12zm-1 4 6 6v12H6V5zm-1 7h5.5L14 6.5z"}),"FileCopySharp"),Le=b(e.jsx("path",{d:"M21 21V3H3v18zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"}),"ImageSharp"),Ce=b(e.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link"),Ie=b(e.jsx("path",{d:"M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"}),"UploadSharp"),Se=({name:l,className:t,size:r="size-7"})=>e.jsx("img",{className:`${r} ${t}`,src:H(l)}),ze=({message:l,bgColor:t="bg-slate-200"})=>e.jsx("div",{className:"z-30 fixed flex justify-center bottom-5 left-0 right-0 ",children:e.jsx("div",{className:`${t} font-bold p-3 rounded-lg`,children:l})}),Re=({data:l})=>{const{links:t,setLinks:r,setIsLinkAdding:h,isLinkAdding:m}=l,[o,N]=n.useState(""),[p,d]=n.useState(""),g=o.trim()&&p.trim(),w=()=>{if(g){const c={id:t.length===0?1:t[t.length-1].id+1,title:o.trim(),link:p.trim()},f=[...t,c];r(f),h(!1)}};return e.jsx(ce,{open:m,onClose:()=>h(!1),children:e.jsxs(Z,{m:4,children:[e.jsxs("div",{className:"grid gap-y-2",children:[e.jsx(D,{size:"small",value:o,onChange:c=>N(c.target.value),placeholder:"Enter title..."}),e.jsx(D,{size:"small",value:p,onChange:c=>d(c.target.value),placeholder:"Enter link..."})]}),e.jsx("div",{className:"mt-2",children:e.jsx(k,{variant:"outlined",startIcon:e.jsx(Ce,{}),onClick:w,children:"Add Link"})})]})})},ms=()=>{const{users:l,posts:t,setPosts:r,setHeaderTitle:h,userId:m}=n.useContext(G),o=se(),{mode:N}=o.palette,p=_(R,"posts"),[d,g]=n.useState(!0),[w,c]=n.useState(!1),[f,x]=n.useState(null),[U,y]=n.useState("posts"),[A,L]=n.useState(null),[C,I]=n.useState(!1);n.useEffect(()=>{h("Admin - Posts")},[]),te(p,[],r,g,c,!1,x);const P=async()=>{const i=W(R,"posts",C);await ne(i)};if(d)return e.jsx(ge,{text:"Loading posts..."});if(w)return e.jsx(X,{text:"No posts available"});if(f)return e.jsx(X,{text:f});const V=()=>{switch(U){case"posts":return e.jsxs("div",{className:"grid gap-y-2",children:[e.jsx(ue,{data:{yesButton:P,noButton:()=>I(!1),text:"Are you sure to delete this post?",setValue:I,value:C}}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(le,{text:"Posts",length:t.length}),e.jsx(k,{size:"small",sx:{textDecoration:"underline"},onClick:()=>y("createPost"),children:"Create a post"})]}),e.jsx("div",{className:"grid border overflow-hidden shadow-md rounded-md border-slate-200 mb-2",children:t.sort((i,S)=>me(i,S,"time","newer")).map((i,S)=>{var M,F,z;return e.jsxs(Z,{className:`${S===0&&"border-t-0"} overflow-hidden ${N==="light"?"hover:bg-slate-100":"hover:bg-slate-700"} cursor-pointer p-2 border-t   min-h-20 flex items-center`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(Ue,{post:i}),e.jsx("p",{className:"mb-2 break-words whitespace-normal",children:de(i.description,25)}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[i.images.length!==0&&e.jsxs("div",{className:"p-1 min-h-9  flex items-center gap-x-1 border border-slate-200 shadow-md rounded-md ",children:[e.jsx(Le,{}),e.jsxs("span",{children:[i.images.length," ",i.images.length<=1?"image":"images"]})]}),i.files.length!==0&&e.jsxs("div",{className:"p-1 min-h-9  flex items-center gap-x-1 border border-slate-200 shadow-md rounded-md ",children:[e.jsx(we,{}),e.jsxs("span",{children:[i.files.length," ",i.files.length<=1?"file":"files"]})]}),i.links&&((M=i==null?void 0:i.links)==null?void 0:M.length)!==0&&e.jsxs("div",{className:"p-1 min-h-9  flex items-center gap-x-1 border border-slate-200 shadow-md rounded-md ",children:[e.jsx(Se,{name:"link"}),e.jsxs("span",{children:[(F=i==null?void 0:i.links)==null?void 0:F.length," ",((z=i==null?void 0:i.links)==null?void 0:z.length)<=1?"link":"links"]})]}),i.draft&&e.jsx("div",{className:"p-1 min-h-9 flex items-center gap-x-1 rounded-md",children:e.jsx("span",{className:"font-bold text-red-500",children:"(Draft)"})})]})]}),e.jsx("div",{className:"flex items-center gap-x-1",children:e.jsx(oe,{isComment:!0,options:[{text:"Edit",icon:e.jsx(pe,{}),onClick:()=>{L(i),y("createPost")}},{text:"Delete",icon:e.jsx(fe,{}),onClick:()=>I(i.id)}]})})]},`post-${i.id}`)})})]});case"createPost":return e.jsx(Ae,{setPage:y,postData:A,setPostData:L})}};return e.jsx("div",{className:"m-5",children:V()})},Ue=({post:l})=>{const{users:t}=n.useContext(G),[r,h]=n.useState(null),[m,o]=n.useState(!0);return ie(l.uid,t,h,o,[],1200),e.jsxs("div",{className:"top-section flex mb-2 gap-x-2",children:[m?e.jsx(Y,{variant:"circular",width:40,height:40}):e.jsx("img",{className:"size-10 rounded-full shadow-md object-cover",src:r==null?void 0:r.image}),e.jsxs("div",{children:[m?e.jsx(Y,{height:40,width:120}):e.jsx("div",{className:"font-medium",children:r==null?void 0:r.name}),e.jsx("div",{className:" text-sm",children:re(he(l.time))})]})]})},Ae=({setPage:l,postData:t,setPostData:r})=>{const{openSnackbar:h,userId:m}=n.useContext(G),[o,N]=n.useState(t?t.images:[]),[p,d]=n.useState(null),[g,w]=n.useState(t?t.description:""),[c,f]=n.useState(t?t==null?void 0:t.files:[]),[x,U]=n.useState(t?(t==null?void 0:t.links)||[]:[]),[y,A]=n.useState(!1),L=g.trim()||o.length!==0||c.length!==0||x.length!==0,C=async(s=!1)=>{try{const a=_(R,"posts");await ae(a,{uid:m,time:T(),editedTime:T(),description:g,images:o,files:c,links:x,draft:s}),l("posts")}catch(a){console.log(a.message)}},I=async()=>{try{const s=W(R,"posts",t.id);await q(s,{editedTime:T(),description:g,images:o,files:c,links:x,draft:!1}),l("posts")}catch(s){console.log(s.message)}},P=async()=>{try{if(t){const s=W(R,"posts",t.id);await q(s,{editedTime:T(),description:g,images:o,files:c,links:x,draft:!0})}else C(!0);l("posts")}catch(s){console.log(s.message)}},V=async s=>{try{const a=await xe(s,{maxSizeMB:.5,maxWidthOrHeight:1280,useWebWorker:!0}),u=`posts/${m}/${s.name}`,j=E(B,u);d("Uploading image...");const v=await J(j,a),$=await K(v.ref),ee=[...o,{name:s.name,path:u,imageURL:$}];N(ee),d("Uploaded image"),setTimeout(()=>{d(null)},3e3)}catch(a){d(a.message),setTimeout(()=>{d(null)},3e3)}},i=async s=>{try{const a=`posts/${m}/${s.name}`,u=E(B,a);d("Uploading file...");const j=await J(u,s),v=await K(j.ref),$=[...c,{name:s.name,path:a,fileURL:v,size:s.size}];f($),d("Uploaded file"),setTimeout(()=>{d(null)},3e3)}catch(a){d(a.message),setTimeout(()=>{d(null)},3e3)}},S=async(s,a)=>{const u=o.filter(v=>a!==v.imageURL);N(u);const j=E(B,s);await Q(j)},M=async(s,a)=>{const u=c.filter(v=>a!==v.fileURL);f(u);const j=E(B,s);await Q(j)},F=s=>{const a=x.filter(u=>s!==u.id);U(a)},z=s=>{document.getElementById(s).click()};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex mb-2 items-center justify-between",children:[p&&e.jsx(ze,{message:p}),e.jsxs("div",{className:"flex gap-x-1 items-center",children:[e.jsx(je,{onClick:()=>{l("posts"),r(null)},children:e.jsx(ve,{})}),e.jsx("div",{children:t?"Edit post":"Create a post"})]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(k,{size:"small",sx:{textDecoration:"underline"},onClick:()=>{L&&P()},startIcon:e.jsx(be,{}),children:"Draft"}),e.jsx(k,{size:"small",sx:{textDecoration:"underline"},onClick:()=>{L?(t?I():C(),r(null)):h("Create a post first")},startIcon:e.jsx(Ie,{}),children:t?"Save":"Publish"})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(D,{multiline:!0,fullWidth:!0,maxRows:20,value:g,onChange:s=>w(s.target.value),className:"p-2 resize-none border",placeholder:"Write description here"}),e.jsx("input",{className:"hidden",id:"imagesInput",type:"file",accept:"image/*",onChange:s=>V(s.target.files[0])}),e.jsx("input",{className:"hidden",id:"filesInput",type:"file",onChange:s=>i(s.target.files[0])}),e.jsxs("div",{className:"flex justify-start gap-x-2 mt-2",children:[e.jsx(k,{size:"small",onClick:()=>z("imagesInput"),variant:"outlined",startIcon:e.jsx(ke,{}),children:"Image"}),e.jsx(k,{size:"small",onClick:()=>z("filesInput"),variant:"outlined",startIcon:e.jsx(ye,{}),children:"File"}),e.jsx(k,{onClick:()=>{A(!0)},variant:"outlined",startIcon:e.jsx(Ne,{}),children:"Link"}),e.jsx(Re,{data:{links:x,setLinks:U,setIsLinkAdding:A,isLinkAdding:y}})]})]}),o.length!==0&&e.jsx("div",{className:"grid gap-y-2",children:o.map(s=>e.jsxs("div",{className:"relative min-h-20",children:[e.jsx("img",{alt:s.name,className:"size-full",src:s.imageURL}),e.jsx("div",{className:"absolute top-1 right-1",children:e.jsx(O,{data:{clickFn:()=>S(s.path,s.imageURL),image:"falseIcon"}})})]},s.imageURL))}),c.length!==0&&e.jsx("div",{className:"grid gap-y-1 mt-2",children:c.map(s=>e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"p-1  min-h-14 rounded-md flex gap-x-1 items-center font-bold border  border-l-4 border-l-green-500",children:[e.jsx("img",{className:"w-7 ",src:H("download")}),e.jsxs("div",{children:[e.jsx("p",{className:"underline text-blue-600",children:s.name}),(s==null?void 0:s.size)&&e.jsxs("p",{children:[(s.size/(1024*1024)).toFixed(2)," MB"]})]})]}),e.jsx("div",{className:"absolute top-1 right-1",children:e.jsx(O,{data:{clickFn:()=>M(s.path,s.fileURL),image:"falseIcon"}})})]},s.fileURL))}),x.length!==0&&e.jsx("div",{className:"grid gap-y-1 mt-2",children:x.map(s=>e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"p-1  min-h-14 rounded-md flex gap-x-1 items-center font-bold border  border-l-4 border-l-green-500 ",children:[e.jsx("img",{className:"w-7 ",src:H("link")}),e.jsx("div",{children:e.jsx("p",{className:"underline text-blue-600",children:s.title})})]}),e.jsx("div",{className:"absolute top-1 right-1",children:e.jsx(O,{data:{image:"falseIcon",clickFn:()=>F(s.id)}})})]},s.link))})]})};export{ms as default};
