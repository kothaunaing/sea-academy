import{j as e,I as V,r as a,A as T,u as M,aG as A,h as R,c as z,b as L,d as U,E as b,aI as Y,aT as Z,S as D,aQ as _,W as q,aC as $,aS as ee,aF as Q,U as te,aJ as W,V as se,aK as ie,aB as ae,aw as ne}from"./index-14pqm9y1.js";import{M as oe}from"./MoreOption-CBEm1e9N.js";import{p as O}from"./prettyDateChat-PSq7xrmC.js";import{P as G}from"./ProfilePicture-N-yMezIS.js";import{s as H}from"./sortByDateNewer-X-Bb2bKS.js";import{n as J}from"./notify-fX9PdEbD.js";import{f as P}from"./fixTime-t8Fgsaat.js";import{S as re}from"./SkeletonUser-FPcBTXzT.js";import{T as N}from"./Tooltip-cTALVPIn.js";import{T as K}from"./Typography-F2i8tb5R.js";import{S as E}from"./Skeleton-aRLWJJ7b.js";import{D as ce}from"./DeleteSharp-bueuT1qV.js";import{B}from"./Button-dux8T5OH.js";import{I as F}from"./IconButton-x0ar69Y7.js";import{F as le,a as me}from"./FavoriteBorder-zXnu4wal.js";import{S as de}from"./Stack-bBqHnaWs.js";import{T as ue}from"./TextField-yLRiE9R7.js";import{C as pe}from"./CloseSharp-6-Zx-Mf5.js";import{c as xe}from"./createSvgIcon-BoAk_7pD.js";import{E as fe}from"./EditSharp-Qr3GQduu.js";const he=xe(e.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"SendSharp"),Ve=({post:n,collectionName:c})=>{const{id:s}=n;R().palette,M();const[d,o]=a.useState(null),[t,k]=a.useState(null),{userId:u}=a.useContext(T),[f,p]=a.useState(!1),[g,C]=a.useState(!0),h=c==="posts",l=z(L(U,c,s),"comments"),r=z(L(U,c,s),"likes"),[S,w]=a.useState(!1),y=async(i,m)=>{const x=z(L(U,c,s),i);console.log("Fetching counts...");const v=await Z(x);m(v.data().count)};a.useEffect(()=>{(async()=>{await y("likes",o),await y("comments",k)})()},[]),a.useEffect(()=>{(async()=>{const m=D(r,_("uid","==",u)),x=await q(m);w(!x.empty)})()},[]);const I=async()=>{try{const i=async()=>{await y("likes",o)},m=L(r,u),x={uid:u,timestamp:$()};S?(w(!1),await Q(m),i()):(w(!0),await ee(m,x),i(),J(["like",h?"post":"test"],h?"description":"testName",h?n.description:n.name,null,s))}catch(i){console.log(i.message)}};return e.jsxs("div",{className:"mt-2",children:[e.jsxs(b,{className:"transition-all mb-1 flex justify-between pl-2 pr-2",children:[e.jsx(B,{size:"small",sx:{textDecoration:"underline",textTransform:"capitalize"},variant:f?"outlined":"text",onClick:()=>{p(!f),C(!g)},children:e.jsxs("span",{children:[d||0," ",d>1?"Likes":"Like"]})}),e.jsxs(B,{size:"small",sx:{textDecoration:"underline",textTransform:"capitalize"},variant:g?"outlined":"text",onClick:()=>{p(!f),C(!g)},children:[t||0," ",t>1?"Comments":"Comment"]})]}),e.jsx(b,{className:"p-2 shadow-lg border-t border-b pt-2 flex gap-x-2",children:e.jsx(N,{title:S?"Unlike":"Like",arrow:!0,children:e.jsx(F,{color:"error",size:"small",sx:{textTransform:"capitalize"},onClick:I,children:S?e.jsx(le,{}):e.jsx(me,{})})})}),f&&e.jsx(je,{isLikesOpen:f,setIsLikesOpen:p,likesRef:r,likeCounts:d}),g&&e.jsx(Ce,{isPost:h,post:n,commentsRef:l,collectionName:c,commentCounts:t,setCommentCounts:k,getCounts:y,isCommentsOpen:g,setIsCommentsOpen:C})]})},je=({likesRef:n,likeCounts:c})=>{const[j,d]=a.useState([]),[o,t]=a.useState(null),[k,u]=a.useState(!0),[f,p]=a.useState(!0),[g,C]=a.useState(!1);R();const h=async()=>{let l=D(n,W("timestamp","desc"),te(8));o&&(l=D(l,se(o)));const r=await q(l);if(r.empty)C(!0),d([]);else{const S=r.docs.map(w=>({id:w.id,...w.data()}));d([...j,...S]),C(!1),S.length<8&&p(!1)}u(!1),t(r.docs[r.docs.length-1])};return a.useEffect(()=>{h()},[]),e.jsxs(b,{sx:{width:{xs:"100%"}},className:"",bgcolor:"background.default",children:[g&&e.jsx("div",{className:"flex items-center justify-center ",children:"No likes yet..."}),k?e.jsx("div",{className:"flex justify-center p-1",children:e.jsx(Y,{})}):e.jsxs("div",{className:"m-2 grid gap-y-2 ",children:[j.sort((l,r)=>H(l,r,"timestamp","newer")).map((l,r)=>e.jsx(ge,{like:l},`user-${l.uid}-${r}`)),e.jsx(de,{direction:"row",justifyContent:"center",children:f?e.jsx(B,{size:"small",onClick:h,children:"Load More"}):""})]})]})},ge=V.memo(({like:n})=>{const{users:c}=a.useContext(T),[s,j]=a.useState(null),[d,o]=a.useState(),t=M();return A(n.uid,c,j,o),d?e.jsx(re,{}):e.jsxs("div",{className:"flex gap-x-2 items-center",children:[e.jsx(N,{title:s?`View ${s&&s.name}'s profile`:"Deleted User",arrow:!0,placement:"top",children:e.jsx("div",{className:"cursor-pointer",onClick:()=>t(`/app/profile/${s==null?void 0:s.uid}`),children:e.jsx(G,{image:s?s.image:"images/sea-logo.jpg",name:s&&s.name,size:"size-9"})})}),e.jsx(N,{title:s?`View ${s&&s.name}'s profile`:"Deleted User",arrow:!0,placement:"top",children:e.jsx(K,{onClick:()=>t(`/app/profile/${s==null?void 0:s.uid}`),variant:"h6",fontSize:"0.9rem",sx:{cursor:"pointer"},children:s?s.name:"Unknown User"})})]})}),Ce=({post:n,isPost:c,commentsRef:s,setCommentCounts:j,getCounts:d})=>{const[o,t]=a.useState(""),[k,u]=a.useState([]),[f,p]=a.useState(!0),[g,C]=a.useState(!1),{userId:h}=a.useContext(T),[l,r]=a.useState(null);R();const S=()=>{const i=D(s,W("timestamp","desc"));return p(!0),ie(i,x=>{d("comments",j),x.empty?(p(!1),C(!0),u([])):(u(x.docs.map(v=>({id:v.id,...v.data()})).sort((v,X)=>H(v,X,"timestamp"))),C(!1),p(!1))})};a.useEffect(()=>{const i=S();return()=>{i&&i()}},[]);const w=async()=>{if(o.trim()){const i={uid:h,text:o.trim(),timestamp:$()};await ae(s,i),t(""),J(["comment",c?"post":"test"],c?"description":"testName",c?n.description:n.name,o.trim(),n.id)}},y=async()=>{const i=L(s,l);if(o.trim()){const m={text:o.trim(),editedTime:$()};await ne(i,m),t(""),r(null)}},I=async i=>{const m=L(s,i);try{await Q(m)}catch(x){console.log(x.message)}};return e.jsxs(b,{sx:{width:{xs:"100%"}},bgcolor:"background.default",children:[g&&e.jsx("div",{className:"flex p-2 items-center justify-center ",children:"No comments yet..."}),e.jsx("div",{className:"grid gap-y-2 m-2",children:k.map(i=>{const m=i.uid===h,x=m&&{text:"Edit",icon:e.jsx(fe,{}),onClick:()=>{r(i.id),t(i.text)}};return e.jsx(ke,{comment:i,editOption:x,yourComment:m,deleteComment:I},`${i.uid}-${i.id}`)})}),e.jsxs("div",{className:"mt-2 flex  gap-x-1 m-2",children:[e.jsx(ue,{fullWidth:!0,size:"small",onChange:i=>t(i.target.value),value:o,placeholder:"Write a comment..."}),e.jsxs("div",{className:"flex gap-x-1",children:[l&&e.jsx(F,{onClick:()=>{r(null),t("")},children:e.jsx(pe,{})}),e.jsx(F,{onClick:()=>{o.trim()&&(l?y():w())},children:e.jsx(he,{})})]})]})]})},ke=V.memo(({comment:n,editOption:c,yourComment:s,deleteComment:j})=>{const{users:d,userData:o}=a.useContext(T),[t,k]=a.useState(null),[u,f]=a.useState(),p=M();return A(n.uid,d,k,f),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex gap-x-1",children:[e.jsx("div",{children:u?e.jsx(E,{variant:"circular",height:40,width:40}):e.jsx(N,{title:t?`View ${t&&t.name}'s profile`:"Deleted User",arrow:!0,placement:"top",children:e.jsx("div",{onClick:()=>p(`/app/profile/${t==null?void 0:t.uid}`),className:"cursor-pointer",children:e.jsx(G,{image:t&&t.image,name:t&&t.name,size:"size-9"})})})}),e.jsxs("div",{className:"max-w-[250px]",children:[e.jsxs("div",{className:"p-2 border  shadow-md border-slate-200 rounded-lg",children:[u?e.jsx(E,{height:40,width:120}):e.jsx(N,{title:t?`View ${t&&t.name}'s profile`:"Deleted User",arrow:!0,placement:"top",children:e.jsx(K,{onClick:()=>p(`/app/profile/${t==null?void 0:t.uid}`),sx:{cursor:"pointer"},variant:"h6",fontSize:"0.9rem",children:t?t.name:"Unknown User"})}),u?e.jsx(E,{sx:{mt:-1},height:60,width:200}):e.jsx("div",{className:"text-left",children:n.text})]}),e.jsx("div",{className:"text-sm text-left mt-1",children:n!=null&&n.editedTime?e.jsxs("span",{children:["edited ",O(P(n.editedTime))]}):e.jsx("span",{children:O(P(n.timestamp))})})]})]}),s||o!=null&&o.isAdmin?e.jsx(oe,{options:[c,{text:"Delete",icon:e.jsx(ce,{}),onClick:()=>j(n.id)}],isComment:!0}):""]})});export{Ve as R};
